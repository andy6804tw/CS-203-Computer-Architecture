<html>

<head>

<title>Systematic and Standard Cyclic Codes</title>

<script language="JavaScript">

//******************************************************************************
//
//	Student Name :	Khaled Humaid
//
//	Course Name  :	ECE655 Fault Tolerant Computing - Fall 03
//
//	Assignment   :	Course Final Project/Simulator
//
//	Description  :	This project simulates the Systematic CRC codes and shows
//  		    	how it is implemented. It also includes the Standard CRC
//  		    	encoder and decoder to illustrate how the Systematic CRC 
//  		    	code differs from the Standard CRC code.
//
//******************************************************************************

//******************************************************************************
// An internal function used to generate the standard CRC codeword, given 
// a data word and a code generator polynomial as parameters.
//******************************************************************************
function Encode(DataWord, CodeGenerator) {

	encoderLengthtemp = CodeGenerator.toString()

	encoderLength = encoderLengthtemp.length

	dataLengthtemp = DataWord.toString()
	
	dataLength = dataLengthtemp.length

	EncodedWordBCH = "" 

	for (i=0; i<dataLength+encoderLength-1; i++) {

		encodedBit = "0"

		for (j=Math.max(i-dataLength+1,0); j<Math.min(i+1,encoderLength); j++) {

			if (IndexIsAOne(CodeGenerator, j) &&

				IndexIsAOne(DataWord, i-j)) {

				if (encodedBit == "0") {

					encodedBit = "1"

				}

				else {

					encodedBit = "0"

				}

			}

		}

		EncodedWordBCH = encodedBit + EncodedWordBCH

	}

        return EncodedWordBCH

}

//******************************************************************************
// Check if each bit in the (numeric) dataword is a "1" or "0" 
//******************************************************************************
function IndexIsAOne(DataWord, index) {

	return(Math.floor(DataWord/Math.pow(10,index+1)) != Math.floor(DataWord/Math.pow(10,index))/10)

}

//******************************************************************************
// This function does the subtraction bit by bit.
//******************************************************************************
function FlipBit(DataWord,index) {

	if (IndexIsAOne(DataWord, index)) {

		DataWord = DataWord - Math.pow(10,index)

	}

	else {

		DataWord = DataWord + Math.pow(10,index)

	}

	return(DataWord)

}

//******************************************************************************
// Validate inputs (data word and code generator). Perform encoding to get 
// Systematic CRC codeword and the Standard CRC codeword.
//******************************************************************************
function EncodeSyst(form) {

	if (!BinNumber(form.DataWord.value)) {
		
		alert("Data Word must be in binary form")

		form.DataWord.focus()

		return

	}

	if (!BinNumber(form.CodeGenerator.value)) {

		alert("Code Generator must be in binary form")

		form.CodeGenerator.focus()

		return

	}

		if (Math.floor(Math.log(form.CodeGenerator.value)/Math.LN10+1) + Math.floor(Math.log(form.DataWord.value)/Math.LN10+1) >17) {

		alert("Too big numbers.")

		return

	}


// check if code generator is a valid one, i.e. can divide (X^n)+1 with remaider zero.

	Xnplus1 = "1"
		
	for (i=form.DataWord.value.length+form.CodeGenerator.value.length-2;i>0;i--){

		Xnplus1 = Xnplus1 + "0" 

	}

	Xnplus1 = Xnplus1 + "1" 

	dividend = parseFloat(Xnplus1)

	divider = parseFloat(form.CodeGenerator.value)

	ignoreit = CyclicDecoderSyst(dividend, divider,form)

	if (parseFloat(form.RemainderSyst.value)>0)	{
	
			alert("The entered Code Generator is invalid; i.e. not a factor of (X^n)+1. See Help for details. Generator is accepted for testing purposes.")
	
	}
		
	form.DecodedWordSyst.value = ""

	form.RemainderSyst.value = ""

	form.FaultDetectedSyst.value = ""

// Encode using Systematic CRC code

	shiftword = form.DataWord.value
		
	for (i=form.CodeGenerator.value.length-1;i>0;i--){

		shiftword = shiftword + "0" 

	}

	form.CodeWordSyst.value = shiftword
	
	Decode(form)
	
	form.EncodedWordSyst.value = form.DataWord.value + form.RemainderSyst.value
	
	form.CodeWordSyst.value = form.EncodedWordSyst.value

	form.DecodedWordSyst.value = ""

	form.RemainderSyst.value = ""

	form.FaultDetectedSyst.value = ""

// Encode using Standard CRC code 

	DataWord = parseFloat(form.DataWord.value)

	CodeGenerator = parseFloat(form.CodeGenerator.value)

	form.EncodedWordBCH.value = Encode(DataWord, CodeGenerator)

	for (i=form.DataWord.value.length+form.CodeGenerator.value.length-form.EncodedWordBCH.value.length-1;i>0;i--){

		form.EncodedWordBCH.value = "0" + form.EncodedWordBCH.value

	}

	form.CodeWordBCH.value = form.EncodedWordBCH.value

	form.DecodedWordBCH.value = ""

	form.RemainderBCH.value = ""

	form.FaultDetectedBCH.value = ""

}

//******************************************************************************
// Validate inputs (encoded word and code generator). Perform decoding for
// Systematic CRC codeword by calling the CyclicDecoderSyst
//******************************************************************************
function Decode(form) {

	if (!BinNumber(form.CodeWordSyst.value)) {

		alert("Encoded Word must be in binary form")
		
		form.CodeWordSyst.focus()
		
		return

	}

	if (!BinNumber(form.CodeGenerator.value)) {

		alert("Code Generator must be in binary form")
		
		form.CodeGenerator.focus()
		
		return

	}

	if ((form.CodeWordSyst.value.length>16) || (form.CodeGenerator.value.length>16)) {

		alert("Too big numbers")

		return

	}

	CodeWordSyst = parseFloat(form.CodeWordSyst.value)

	CodeGenerator = parseFloat(form.CodeGenerator.value)

	form.DecodedWordSyst.value = CyclicDecoderSyst(CodeWordSyst, CodeGenerator,form)

		for (i=form.CodeWordSyst.value.length-form.CodeGenerator.value.length-form.DecodedWordSyst.value.length+1;i>0;i--){

		form.DecodedWordSyst.value = "0" + form.DecodedWordSyst.value

	}

}

//********************************************************************************
// Decode the Systematic CRC encoded word. Perform division (Subtraction/addition)
// to get quotient and remainder. 
//********************************************************************************
function CyclicDecoderSyst(EncodedWordSyst, CodeGenerator,form) {

	encoderLengthtemp = CodeGenerator.toString()
	
	encoderLength = encoderLengthtemp.length

	dataLengthtemp = EncodedWordSyst.toString()
	
	dataLength = dataLengthtemp.length

	DecodedWordSyst = "" 

	for (i=dataLength-1; i>encoderLength-2; i--) {

		decodedBit = "0"

		if (IndexIsAOne(EncodedWordSyst, i)) {

			decodedBit = "1"

			for(j=0; j<encoderLength; j++) {

				if (IndexIsAOne(CodeGenerator, j)) {

					EncodedWordSyst = FlipBit(EncodedWordSyst,i-encoderLength+j+1)

				}

			}

		}

		DecodedWordSyst =  DecodedWordSyst + decodedBit

	}

	form.RemainderSyst.value = ""

	for (i=0; i<encoderLength-1; i++) {

		if (IndexIsAOne(EncodedWordSyst, i)) {

			form.RemainderSyst.value = "1" + form.RemainderSyst.value

		}

		else {

			form.RemainderSyst.value = "0" + form.RemainderSyst.value

		}

	}

	if (parseFloat(form.RemainderSyst.value)>0) {

		form.FaultDetectedSyst.value = "yes"

	}

	else {

		form.FaultDetectedSyst.value = "no"

	}

        return DecodedWordSyst

}

//********************************************************************************
// Decode the Standard CRC encoded word. Perform division (Subtraction/addition)
// to get quotient and remainder. 
//********************************************************************************
function CyclicDecoderBCH(EncodedWordBCH, CodeGenerator,form) {

	encoderLengthtemp = CodeGenerator.toString()
	
	encoderLength = encoderLengthtemp.length

	dataLengthtemp = EncodedWordBCH.toString()
	 
	dataLength = dataLengthtemp.length

	DecodedWordBCH = "" 

	for (i=dataLength-1; i>encoderLength-2; i--) {

		decodedBit = "0"

		if (IndexIsAOne(EncodedWordBCH, i)) {

			decodedBit = "1"

			for(j=0; j<encoderLength; j++) {

				if (IndexIsAOne(CodeGenerator, j)) {

					EncodedWordBCH = FlipBit(EncodedWordBCH,i-encoderLength+j+1)

				}

			}

		}

		DecodedWordBCH =  DecodedWordBCH + decodedBit

	}

	form.RemainderBCH.value = ""

	for (i=0; i<encoderLength-1; i++) {
	
		if (IndexIsAOne(EncodedWordBCH, i)) {

			form.RemainderBCH.value = "1" + form.RemainderBCH.value

		}

		else {

			form.RemainderBCH.value = "0" + form.RemainderBCH.value

		}

	}

	if (parseFloat(form.RemainderBCH.value)>0) {

		form.FaultDetectedBCH.value = "yes"

	}

	else {

		form.FaultDetectedBCH.value = "no"

	}

        return DecodedWordBCH

}


//******************************************************************************
// Validate input data for binary numbers only.
//******************************************************************************
function BinNumber(DataWord) {

	for (i=0;i<DataWord.length;i++) {

		if ((parseFloat(DataWord.substring(i,i+1)) != 1)

			&& (parseFloat(DataWord.substring(i,i+1)) != 0)) {

			return false

		}

	}

	return true

}

//******************************************************************************
// Validate input (encoded word and code generator) of Systematic CRC decoder.  
// Call CyclicDecoderSyst routine to perform decoding of Systematic CRC codeword.
//******************************************************************************
function DecodeSyst(form) {

	if (!BinNumber(form.CodeWordSyst.value)) {

		alert("Encoded Word must be in binary form")
		
		form.CodeWordSyst.focus()

		return

	}

	if (!BinNumber(form.CodeGenerator.value)) {

		alert("Code Generator must be in binary form")
		
		form.CodeGenerator.focus()
		
		return

	}

	if (form.CodeWordSyst.value.length>16) {

		alert("Too big codeword")

		form.CodeWordSyst.focus()

		return

	}

	if (form.CodeGenerator.value.length > form.CodeWordSyst.value.length) {

		alert("Code generator cannot be longer than codeword")

		form.CodeGenerator.focus()

		return

	}

	CodeWordSyst = parseFloat(form.CodeWordSyst.value)

	CodeGenerator = parseFloat(form.CodeGenerator.value)

	form.DecodedWordSyst.value = CyclicDecoderSyst(CodeWordSyst, CodeGenerator,form)

	form.DecodedWordSyst.value = form.CodeWordSyst.value.substring(0,form.CodeWordSyst.value.length-form.CodeGenerator.value.length+1)
		
	for (i=form.CodeWordSyst.value.length-form.CodeGenerator.value.length-form.DecodedWordSyst.value.length+1;i>0;i--){

	form.DecodedWordSyst.value = "0" + form.DecodedWordSyst.value

	}

}

//******************************************************************************
// Validate input (encoded word and code genrator) of standard CRC decoder.  
// Call CyclicDecoderBCH routine to perform decoding of Standard CRC codeword.
//******************************************************************************
function DecodeBCH(form) {

	if (!BinNumber(form.CodeWordBCH.value)) {

		alert("Encoded Word must be in binary form")
		
		form.CodeWordBCH.focus()

		return

	}

	if (!BinNumber(form.CodeGenerator.value)) {

		alert("Code Generator must be in binary form")
		
		form.CodeGenerator.focus()

		return

	}

	if (form.CodeWordBCH.value.length>16) {

		alert("Too big codeword")

		form.CodeWordBCH.focus()

		return

	}

	if (form.CodeGenerator.value.length > form.CodeWordBCH.value.length) {

		alert("Code generator cannot be longer than codeword")

		form.CodeGenerator.focus()

		return

	}

	CodeWordBCH = parseFloat(form.CodeWordBCH.value)

	CodeGenerator = parseFloat(form.CodeGenerator.value)

	form.DecodedWordBCH.value = CyclicDecoderBCH(CodeWordBCH, CodeGenerator,form)

		for (i=form.CodeWordBCH.value.length-form.CodeGenerator.value.length-form.DecodedWordBCH.value.length+1;i>0;i--){

		form.DecodedWordBCH.value = "0" + form.DecodedWordBCH.value

	}

}

//******************************************************************************
// Open the simulator help information in a new window
//******************************************************************************
function Help() {

   open("SystematicCRChelp.html")
   
}

//******************************************************************************
// Reset all fields (input and output) and go to the top of the form.
//******************************************************************************
function ResetInput(form) {

	form.DataWord.value = ""
		
	form.CodeGenerator.value = ""
	
	form.EncodedWordSyst.value = ""
	
	form.EncodedWordBCH.value = ""
	
	form.CodeWordSyst.value = ""

	form.DecodedWordSyst.value = ""

	form.RemainderSyst.value = ""

	form.FaultDetectedSyst.value = ""
	
	form.CodeWordBCH.value = ""

	form.DecodedWordBCH.value = ""

	form.RemainderBCH.value = ""

	form.FaultDetectedBCH.value = ""
	
	location.hash="top"

	form.DataWord.focus()
}

//******************************************************************************
</script>

</head>

<body bgcolor="#66CCFF">

<a name="top">&nbsp;</a>
<p align="center"><b><font size="5">Systematic and Standard Cyclic Codes</font></b></p>
<p><font size="4"><b>Cyclic Encoder:</b></font></p>

<FORM>

<table border="1" cellspacing="1"  cellpadding="17" width="100%" align="center">
  <tr>
    <td width="27%">
    	<font size="3">Enter Data Word: </font><br>
 	<input type="text" name="DataWord" size="20"><p> 
	<font size="3">Enter Code Generator: </font><br>
	<input type="text" name="CodeGenerator" size="20">
    </td>
    <td width="19%">
    	<br><br>&nbsp;<input type="button" value="Encode --&gt;" name="btnEncode" onClick="EncodeSyst(this.form)">
    </td>
    <td width="27%">
    	<p align="center">
    	<font color="#000099">
    	<i><font size="4"><b>Systematic CRC</b></font></i> </font>
        	</p>
        	<p>Encoded Word:<br>
            <input type="text" readonly name="EncodedWordSyst" size="20"></p>
    </td>
    <td width="27%">
    	<p align="center">
	<font color="#000099">
    	<i><font size="4"><b>Standard CRC</b></font></i> </font>
        	</p>
        	<p>Encoded Word:<br>
            <input type="text" readonly name="EncodedWordBCH" size="20"></p>
    </td>
  </tr>
</table>

<br><br>
<p><font size="4"><b>Cyclic Decoder:</b></font></p>
<ul>
  <li>
	<p align="left"><font size="4" color="#000099"><b><i>Systematic CRC</i></b></font></p>
  </li>
</ul>

<table border="1" cellspacing="1" cellpadding="17" width="73%">
  <tr>
    <td width="37%">
    	<font size="3">Enter Encoded Word: </font><br>
	<input type="text" name="CodeWordSyst" size="20"> 
    </td>
    <td width="26%">
    	<br>&nbsp;<input type="button" value="Decode --&gt;" name="btnDecodeSyst" onClick="DecodeSyst(this.form)">
    </td>
    <td width="37%"> 
    	Decoded Word: <BR><INPUT type="text" readonly name="DecodedWordSyst" size="20"><BR>
	Remainder: <BR><INPUT type="text" readonly name="RemainderSyst" size="20"><BR>
	Error Detected?<BR><INPUT type="text" readonly name="FaultDetectedSyst" size="20">
    </td>
  </tr>
</table>

<br><br>
<ul>
  <li>
  	<p align="left"><font size="4" color="#000099"><b><i>Standard CRC</i></b></font></p>
 </li>
</ul>

<table border="1" cellspacing="1" cellpadding="17" width="73%">
  <tr>
    <td width="37%">
    	<font size="3">Enter Encoded Word: </font><br>
	<input type="text" name="CodeWordBCH" size="20"> 
  	</td>
    <td width="26%">
    	<br>&nbsp;<input type="button" value="Decode --&gt;" name="btnDecodeBCH" onClick="DecodeBCH(this.form)">
    </td>
    <td width="37%"> 
    	Decoded Word: <BR><INPUT type="text" readonly name="DecodedWordBCH" size="20"><BR>
	Remainder: <BR><INPUT type="text" readonly name="RemainderBCH" size="20"><BR>
	Error Detected?<BR><INPUT type="text" readonly name="FaultDetectedBCH" size="20">
    </td>
  </tr>
</table>

<br><br>
<p align="left">
	<input type="button" value="Reset  All Fields" name="btnReset" onClick="ResetInput(this.form)">&nbsp;&nbsp;&nbsp;
	<input type="button" value="Help & Info" name="btnHelp" onClick="Help()">
</p>

</FORM>

</body>

</html>