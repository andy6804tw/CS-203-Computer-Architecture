<HTML>
<HEAD>
<TITLE> Trigonometric Functions </TITLE>
<SCRIPT language="JavaScript">

function PrintError(Message) {
	Error = "<CENTER><H1> ERROR </H1></CENTER> <P>\n"
	Error += "<CENTER> <EM>" + Message + "</EM> </CENTER>\n"
	return Error
}

function RoundOff (TheNum) {
	// returns the value TheNum would have if it were represented by
	// NumDecimals bits after the decimal point
	Scaling = Math.pow(2, NumDecimals)
	return (Math.round(TheNum * Scaling) / Scaling)
}

function ParseBinary (BinNum) {
	// Turns a binary number into a decimal, sets a flag to true if
	// BinNum is not actually binary

	IsNeg = false
	if (BinNum < 0) {
		IsNeg = true
		BinNum *= -1
	}
	RealNum = 0
	LogBaseTen = Math.log(BinNum)/Math.LN10
	HighestPlace = Math.ceil(LogBaseTen)
	for (CurPlace = HighestPlace; CurPlace >= -NumBits; CurPlace--) {
		CurEntry = Math.round(BinNum / Math.pow(10, CurPlace))
		if (CurEntry != 0 && CurEntry != 1) {
			NotBinary = true
			CurEntry = 1 // feed it something normal, to avoid
					 // wierd Javascript errors
		}
		if (CurEntry == 1) {
			RealNum += Math.pow(2, CurPlace)
			BinNum -= Math.pow(10, CurPlace)
		}
	}
	if (IsNeg) {RealNum *= -1} // reverse it back at the end

	// now check if the number was negative according to two's complement
	// representation - if it was, set the decimal value to this negative
	// number
	if (HighestPlace == NumBits) {
		RealNum -= Math.pow(2, NumBits)
	}

	return RealNum
}

function OrderOfMagnitude (TheNum) {
	// returns the highest place which has a "1" in TheNum's
	// binary representation - special non-2's complement version

	LogBaseTwo = Math.log(TheNum)/Math.LN2;
	return Math.floor(LogBaseTwo)
}

function PrintBinary(TheNum, NumDecs) {

	// initialize the string
	S = "";
	// deal with negative numbers
	if (TheNum < 0) {
		S += "-"
		TheNum *= -1
	}
	StartPlace = OrderOfMagnitude(TheNum)
	if (StartPlace < 0) {StartPlace = 0}

	for (CurPlace = StartPlace; CurPlace >= -NumDecs; CurPlace--) {
		if (CurPlace == -1) {S += "."}
		CurPower = Math.pow(2, CurPlace)
		if (TheNum >= CurPower) {
			S += "1"
			TheNum = TheNum - CurPower
		} else  {
			S += "0"
		}
	}
	return S
}

function Trig(form) {
	C = parseFloat(form.C.value)
	NumDecimals = parseFloat(form.NumDecimals.value) - 1
	NumBits = NumDecimals
	ChoseBin = form.Base[0].checked
	NotBinary = false
	if (ChoseBin) {C = ParseBinary(C)}

	TheTop = "<HTML><HEAD><TITLE>Tablet</TITLE></HEAD><BODY bgcolor=white>"
        B = C
	C = RoundOff(C)
	Middle = "C = " + C + "<P>\n"
	Middle += "<TABLE border>"
	Middle += "<TR> <TD> <var>i</var> <TD> <var>x<sub>i</sub></var> "
	Middle += "<TD> <var>Z<sub>i</sub></var> <TD> <var>W<sub>i</sub></var> "
	Middle += "<TD> <var>s<sub>i</sub></var>" + "\n"
	iCol = ""	// initialize the five columns of the table
	xCol = ""
	ZCol = ""
	WCol = ""
	sCol = ""

	K = 1
	for (i = 0; i < NumDecimals; i++) {
		K *= Math.sqrt(1 + Math.pow(2, -2 * i))
	}
	x = C
	Z = RoundOff(1/K)	// approximately 6.074 for NumBits > 5
	W = 0
	for (i = 0; i <= NumDecimals; i++) {
		iCol += i + " <BR>\n"
		s = (x >= 0 ? 1 : -1)
		xCol += PrintBinary(x, NumDecimals) + " <BR>\n"
		x = RoundOff(x - Math.atan(s * Math.pow(2, -i)))
		ZCol += PrintBinary(Z, NumDecimals) + " <BR>\n"
		OldZ = Z	// needed to calculate W
		Z = RoundOff(Z - s * Math.pow(2, -i) * W)
		WCol += PrintBinary(W, NumDecimals) + " <BR>\n"
		W = RoundOff(W + s * Math.pow(2, -i) * OldZ)
		sCol += s + " <BR>\n"
	}
	// for last row...
	iCol += i + " <BR>\n"
	xCol += PrintBinary(x, NumDecimals) + " <BR>\n"
	ZCol += PrintBinary(Z, NumDecimals) + " <BR>\n"
	WCol += PrintBinary(W, NumDecimals) + " <BR>\n"
	// don't print s

	Middle += "<TR> <TD> " + iCol + "<TD align=right> " + xCol
	Middle += "<TD align=right> " + ZCol + "<TD align=right> " + WCol 
	Middle += "<TD valign=top align=right> " + sCol

	Middle += "</TABLE> <P>\n"
	Middle += "cos(C) = Z<sub>" + i + "</sub> = " 
	Middle += PrintBinary(Z, NumDecimals) + " = " + Z + " <BR>\n"
	Middle += "Actual value = " + Math.cos(B) + ", error = " +
			Math.abs(Math.cos(B) - Z) +"<P>\n"
	Middle += "sin(C) = W<sub>" + i
	Middle += "</sub> = " + PrintBinary(W, NumDecimals) + " = " + W + "<BR>\n"
	Middle += "Actual value = " + Math.sin(B) + ", error = " +
			Math.abs(Math.sin(B) - W)
	Bottom = "</BODY> </HTML>"

	if (NotBinary) {Middle = PrintError("Non-binary number")}


	parent.frames[1].document.open()
	parent.frames[1].document.write(TheTop);
	parent.frames[1].document.write(Middle);
	parent.frames[1].document.write(Bottom);
	parent.frames[1].document.close()

}

</SCRIPT>
</HEAD>

<BODY bgcolor="#D8D8BF">

<CENTER> <H2> Trigonometric Functions </H2> </CENTER>
<FORM>
C: <INPUT type="text" name="C">
<P>
<EM>bin</EM> <INPUT type="radio" name="Base" value="Binary" checked>
<EM>dec</EM> <INPUT type="radio" name="Base" value="Decimal">
<P>
Number of bits: <INPUT type="text" name="NumDecimals" size=4>
<P>
<CENTER>
<INPUT type="button" name="enter" value="Compute"
onClick="Trig(this.form)">
</CENTER>
</FORM>

</BODY>
</HTML>
