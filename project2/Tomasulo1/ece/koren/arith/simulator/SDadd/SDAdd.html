<HTML>
<HEAD>
<TITLE> Signed Digit Arithmetic </TITLE>
<SCRIPT language="JavaScript">

function MakeLine(NumColumns) 
{
    return "<TR> <TD colspan=" + NumColumns + "> <HR color=#000000 noshade size=1>\n";
}

//*************************************************************************
//
//	PROCEDURE : sdNumberIsValid
//
//	INPUTS : inputString:  A string that holds an signed digit number
//				to check
//		radix:  The radix of the signed decimal number
//
//	DESCRIPTION : Examines each character of inputString (other than '-') 
//			and determines whether	the character represents a 
//			valid digit given radix 
//
//	OUTPUTS : Returns true if inputString is a valid signed digit
//		representation in radix, false otherwise.
//
//*************************************************************************
function sdNumberIsValid(inputString, radix)
{
	var digitsAreValid = true;
	var currentDigit = 0;

	i=0;
	while(i < inputString.length && digitsAreValid == true)
   	{
       		if (inputString.charAt(i) != '-')
		{
			currentDigit = parseInt(inputString.charAt(i), radix);
	
			if (isNaN(currentDigit))
				digitsAreValid = false;
		}
		i++;
	}

	return digitsAreValid;
}

//*************************************************************************
//
//	PROCEDURE : operandsAreValid
//
//	INPUTS : form: the form that holds the controls for this script
//
//	DESCRIPTION : Validates ech operand
//
//	OUTPUTS : Returns true if all of the user entered operands are in
//			the correct range and legal, false otherwise.
//
//*************************************************************************
function operandsAreValid(form)
{
	var radix = Number(form.radixTextbox.value);
	var alpha = Number(form.alphaTextbox.value);
	var alphaMinValue = Math.ceil((radix+1)/2);
	var alphaMaxValue = radix - 1;
	
	//  Validate radix first...everything else depends on radix
	if (radix < 2 ||  radix > 16)
	{
		alert("Invalid radix.  Radix must be between 2 and 16");
		form.radixTextbox.focus();
		return false;
	}
	
	//  Validate alpha
	else if (radix == 2 && alpha != 1)
	{
		alert("Invalid alpha.  Alpha must be 1 for binary signed decimal.  The entry has been corrected for you.");
		form.alphaTextbox.value = 1;
		form.alphaTextbox.focus();
		return false;
	}
	else if (radix != 2 && (alpha < alphaMinValue || alpha > alphaMaxValue))
	{
		if (alphaMinValue == alphaMaxValue)
		{
			alert("Invalid alpha.  Alpha must be " + alphaMinValue + ".  The entry has been corrected for you.");
			form.alphaTextbox.value = alphaMinValue;
		}
		else
			alert("Invalid alpha.  Alpha must be between " + alphaMinValue + " and " + alphaMaxValue);
			
		form.alphaTextbox.focus();
		return false;
	}
	
	//  Validate input A
	else if (sdNumberIsValid(form.inputATextbox.value, radix) == false)
	{
		alert("Invalid input in A.  Digits must be between " + (-1 * (radix-1)) + " and "  + (radix-1));
		form.inputATextbox.focus();
		return false;
	}	
	//  Validate input B
	else if (sdNumberIsValid(form.inputBTextbox.value, radix) == false)
	{
		alert("Invalid input in B.  Digits must be between " + (-1 * (radix-1)) + " and "  + (radix-1));
		form.inputBTextbox.focus();
		return false;
	}
	return true;
}

//*************************************************************************
//
//	PROCEDURE : sdStringToArray
//
//	INPUTS : inputString:  A string that holds an signed digit number
//				to convert to an array
//		radix:  The radix of the signed decimal number
//		resultantArray: The array that will hold the signed decimal
//				number after conversion
//		requiredNumberOfDigits: the total number of digits that the 
//				signed decimal number should have.  
//	DESCRIPTION : Converts each signed decimal digit in inputString
//		to its numberic value and places the value in resultantArray.
//		If requiredNumberOfDigits is greated than the length of 
//		inputString, the beginning of the array is padded with 0's
//		to create a total of requiredNumberOfDigits positions
//		in resultantArray.  If requiredNumberOfDigits is less than  
//		the length of inputString, requiredNumberOfDigits is ignored.
//
//	OUTPUTS : resultantArray
//
//*************************************************************************
function sdStringToArray(radix, inputString, resultantArray, requiredNumberOfDigits)
{
	var value = 0
	var currentResultantArrayIndex = requiredNumberOfDigits - 1;
	resultantArray.length = requiredNumberOfDigits;
	
	//  Get the size of inputString without minus signs
	searchPattern = /-/gi;
	tempString = inputString.replace(searchPattern, "");
	
	//  Zero pad the array if necessary to get requiredNumberOfDigits
	//  number of digits
	if (requiredNumberOfDigits != "undefined")
	{
		//  zero pad the beginning of the array
		for (j=resultantArray.length-1; j >= tempString.length; j--)
			resultantArray[j] = 0;
	}
	currentResultantArrayIndex = j;
	
	//  Convert each character of inputString to a number and add the
	//  resultant number to the end of resultantArray.  
	i=0;
	while (i < inputString.length)
	{
		if (inputString.charAt(i) == "-")
		{
			//  Process negative number.  Get next number and save as a
			//  negative value
			i++;
			value = -1 * parseInt(inputString.charAt(i), radix);
		}
		else
		{
			//  Process positive number
			value = parseInt(inputString.charAt(i), radix);
		}
		
		//  Place value in resultantArray strating at the most significant 
		//  digit
		resultantArray[currentResultantArrayIndex] = value;
		currentResultantArrayIndex--;
		i++;
	}
} 

//*************************************************************************
//
//	PROCEDURE : printFormattedSDNumber
//
//	INPUTS : sdNumberArray : The array that holds the the signed 
//			decimal number to be printed. 
//		outputDocument : The document where the signed decimal
//			number should be written.
//		prefix : a string that holds any text to be appeneded
//			to the beginning of the line
//		suffix : a string that holds any text to be appeneded
//			to the end of the line
//		startInCarryColumn : If startInCarryColumn is true, writing
//			begins 1 column to the left of numbers where 
//			startInCarryColumn is false
//
//	DESCRIPTION : Prints a signed decimal number to outputDocument.  
//
//	OUTPUTS : none
//
//*************************************************************************
function printFormattedSDNumber(sdNumberArray, 
								outputDocument, 
								prefix, 
								suffix,
								startInCarryColumn)
{
	var currentCharacter;
	outputLine = new String;
	
	//  Start a row
	outputDocument.writeln("<TR>");
	
	//  write the prefix
	if (prefix != "undefined")
		outputDocument.writeln("<TD ALIGN='right'>" + prefix + "</TD>");
	else
		outputDocument.writeln("<TD ALIGN='right'></TD>");
		
	//  If startInCarryColumn is true, start writing number 1 column to the 
	//  left of numbers where startInCarryColumn is false
	if (startInCarryColumn != true)
		outputDocument.writeln("<TD ALIGN='right'></TD>");
		
	//  format the signed digit number starting at the most significant digit
	for(i=sdNumberArray.length-1; i >= 0; i--)
	{
		currentCharacter = String(sdNumberArray[i]);
		
		//  Format the width of the character to 4 spaces
		switch (currentCharacter.length)
		{
			case 1: currentCharacter = "<TD ALIGN='right'>&nbsp;&nbsp;&nbsp;" + currentCharacter + "</TD>";
				break;
			case 2: currentCharacter = "<TD ALIGN='right'>&nbsp;&nbsp;" + currentCharacter + "</TD>";
				break;			
			case 3: currentCharacter = "<TD ALIGN='right'>&nbsp;" + currentCharacter + "</TD>";
				break;			
		}
		outputLine = outputLine + currentCharacter;
	}

	//  Append the comment
	if (suffix != "undefined")
		outputLine = outputLine + "<TD ALIGN='right'>&nbsp;&nbsp;&nbsp;" + suffix + "</TD>";
	else
		outputDocument.writeln("<TD></TD>");

	//  print the output line
	outputDocument.writeln(outputLine);

	//  Close the row 
	outputDocument.writeln("</TR>");
}

//*************************************************************************
//
//	PROCEDURE : invertSDNumber
//
//	INPUTS : valueArray:  The array that holds the signed decimal number
//				to be inverted 
//		invertedValueArray: The array that will hold the inverted
//				signed decimal number 
//
//	DESCRIPTION : Inverts the digits of valueArray and returns the 
//			result in invertedValueArray
//
//	OUTPUTS : invertedValueArray
//
//*************************************************************************
function invertSDNumber(valueArray, invertedValueArray)
{
	var value=0;
	invertedValueArray.length = valueArray.length;
	
	//  Convert each character of inputString to a number and add the
	//  resultant number to the end of resultantArray.  Start at the 
	//  most significant digit to 
	for (i=0; i <  valueArray.length; i++)
	{
		//  Invert value Xi
		value = -1 * valueArray[i];
		invertedValueArray[i] = value;
	}						
} 

//*************************************************************************
//
//	PROCEDURE : convertSDToDecimal
//
//	INPUTS : radix:  The radix of the signed decimal number
//		sdValueArray:  The array that holds the signed decimal number
//				to be converted 
//
//	DESCRIPTION : converts a signed digit number to decimal
//
//	OUTPUTS : decimal value of the signed digit number
//
//*************************************************************************
function convertSDToDecimal(radix, sdValueArray)
{
	var decimalValue=0;

	//  convert each digit of sdValueArray decimal starting at the most
	for (i=sdValueArray.length-1; i >= 0; i--)
	{
		//  Invert value Xi
		decimalValue += sdValueArray[i] * Math.pow(radix, i);
	}	
	return decimalValue					
} 

//*************************************************************************
//
//	PROCEDURE : performSDAddition
//
//	INPUTS : operandBArray, operandAArray : The arrays that hold the 
//			signed decimal numbers to be added.  The arrays must
//			contain the NUMERIC value for each digit of the 
//			operands.
//		radix:  The radix of the signed decimal number
//		alpha : The alpha value to use when adding the signed decimal 
//			operands.
//		outputDocument : The document where the text for the 
//			intermediate and final results of the operation 
//			should be written.
//		resultantArray: The array that will hold the result of 
//			operandAArray + operandBArray	
//
//	DESCRIPTION : Adds operandAArray to operandBArray using the rules
//			for signed digit addition.  This function writes
//			the values for Ci, Ui, and the result of the 
//			operation (Si) to outputDocument.  The result of the
//			operation (Si) is returned in resultArray.
//
//			Note that is is assumed that the operands are of equal length.
//
//	OUTPUTS : returns the final result of the addition in resultArray.
//
//*************************************************************************
function performSDAddition(operandAArray, 
				operandBArray, 
				radix, 
				alpha, 
				outputDocument,
				resultArray)
{
	cArray = new Array  //  cArray holds the values for Ci
	uArray = new Array  //  uArray holds the values for Ui
	
	cArray.length = operandAArray.length + 1;
	uArray.length = operandAArray.length + 1;
	resultArray.length = operandAArray.length;
	cArray[0] = 0;
	
	//  Show the operation to be performed in the results document
	printFormattedSDNumber(operandAArray, outputDocument, " ", "   = " + convertSDToDecimal(radix, operandAArray) + " in decimal", false);
	printFormattedSDNumber(operandBArray, outputDocument, "+", "   = " + convertSDToDecimal(radix, operandBArray) + " in decimal", false);
	outputDocument.writeln(MakeLine(15));

	//  Procedure depends on whether the radix is binary
	if (radix != 2)  //  easy case
	{
		//  Deal with the digits starting with least significant digit
		for (i=0; i < operandAArray.length; i++)
		{
			//  Select carry
			if ((operandAArray[i] + operandBArray[i]) >= alpha)
				cArray[i+1] = 1;
			else if ((operandAArray[i] + operandBArray[i]) <= (-1 * alpha))
				cArray[i+1] = -1;
			else if (Math.abs(operandAArray[i] + operandBArray[i]) < alpha)
				cArray[i+1] = 0;

			uArray[i] = (operandAArray[i] + operandBArray[i]) - (radix * cArray[i+1]);
		}
	}
	else //  binary case
	{
		//  Deal with the digits starting with least significant digit
		for (i=0; i < operandAArray.length; i++)
		{
			//  A[i] == B[i] handles the cases where (A[i], B[i]) is
			//  (0,0), (1,1) or (-1, -1)
			if (operandAArray[i] == operandBArray[i])
			{
				cArray[i+1] = operandAArray[i];
				uArray[i] = 0;
			}
			//  A[i] == 0 ||  B[i] == 0 pertains to the remaining cases where 
			//  (A[i], B[i]) is  (0,1), (1,0), (-1, 0), (0, -1)
			else if (operandAArray[i] == 0 || operandBArray[i] == 0)
			{
				//  A[i] + B[i] < 0 pertains to the cases where 
				//  (A[i], B[i]) is  (-1, 0) or (0, -1) 
				if (operandAArray[i] + operandBArray[i] < 0)
				{
					//  This block handles the case where:
					//  1.  the current digit is the rightmost digit 
					//			(no A[i-1] or B[i-1]
					//  or
					//	2.  neither A[i-1] nor B[i-1] are -1
					if ((i == 0) || (operandAArray[i-1] != -1 && operandBArray[i-1] != -1))
					{
						cArray[i+1] = 0;
						uArray[i] = -1;
					}
					//  This block handles the case where:
					//  at least one of either A[i-1] or B[i-1] are -1
					else
					{
						cArray[i+1] = -1;
						uArray[i] = 1;
					}
				}
				//  A[i] + B[i] > 0 pertains to the cases where 
				//  (A[i], B[i]) is  (1, 0) or (0, 1) 
				else if (operandAArray[i] + operandBArray[i] > 0)
				{
					//  This block handles the case where:
					//  1.  the current digit is the rightmost digit 
					//			(no A[i-1] or B[i-1]
					//  or
					//	2.  neither A[i-1] nor B[i-1] are -1
					if ((i == 0) || (operandAArray[i-1] != -1 && operandBArray[i-1] != -1))
					{
						cArray[i+1] = 1;
						uArray[i] = -1;
					}
					//  This block handles the case where:
					//  at least one of either A[i-1] or B[i-1] are -1
					else
					{
						cArray[i+1] = 0;
						uArray[i] = 1;
					}
				}
			}
			//  A[i]!= B[i] and neither are 0.  This block handles
			//  the cases where (A[i], B[i]) is  (1, -1) or (-1, 1) 
			else 
			{
				cArray[i+1] = 0;
				uArray[i] = 0;
			}
		}
	}
	
	uArray[uArray.length - 1] = 0;
	
	//  Show Ci and Ui arrays in the results document
	printFormattedSDNumber(cArray, outputDocument, " ", "     Ci", true);
	printFormattedSDNumber(uArray, outputDocument, " ", "     Ui", true);
	outputDocument.writeln(MakeLine(15));

	//  Calculate final result and place the digits in resultArray
	for (i=0; i < cArray.length; i++)
		resultArray[i] = cArray[i] + uArray[i];
	
	//  Show final result in the results document
	printFormattedSDNumber(resultArray, outputDocument, "", "   = " + convertSDToDecimal(radix, resultArray) + " in decimal", true);
}

//*************************************************************************
//
//	PROCEDURE : performSDSubtraction
//
//	INPUTS : operandBArray, operandAArray : The arrays that hold the 
//			signed decimal numbers to be subtracted.  The arrays must
//			contain the NUMERIC value for each digit of the 
//			operands.
//		radix:  The radix of the signed decimal number
//		alpha : The alpha value to use when adding the signed decimal 
//			operands.
//		outputDocument : The document where the text for the 
//			intermediate and final results of the operation 
//			should be written.
//		resultantArray: The array that will hold the result of 
//			operandAArray - operandBArray	
//
//	DESCRIPTION : Subtracts operandBArray from operandAArray using the rules
//			for signed digit subtraction.  This function writes
//			the values for Ci, Ui, and the result of the 
//			operation (Si) to outputDocument.  The result of the
//			operation (Si) is returned in resultArray.
//
//			Note that this routine inverts operandBArray, and
//			calls performSDAddition to perform the operation.
//
//	OUTPUTS : returns the final result of the addition in resultArray.
//
//*************************************************************************
function performSDSubtraction(operandAArray, 
				operandBArray, 
				radix, 
				alpha, 
				outputDocument,
				resultArray)
{
	invertedBArray = new Array
	invertedBArray.length = operandBArray.length;
	
	//  Show the operation to be performed in the results document
	printFormattedSDNumber(operandAArray, outputDocument, " ", "   = " + convertSDToDecimal(radix, operandAArray) + " in decimal", false);
	printFormattedSDNumber(operandBArray, outputDocument, "-", "   = " + convertSDToDecimal(radix, operandBArray) + " in decimal", false);
	outputDocument.writeln(MakeLine(15));

	outputDocument.writeln("<TR><TD>The operation </TD></TR><TR><TD> will be performed as:</TD></TR>");

	//  Invert B value
	invertSDNumber(operandBArray, invertedBArray);

	//  Perform subtraction by adding the inverted B value to A
	performSDAddition(operandAArray, 
				invertedBArray, 
				radix, 
				alpha, 
				outputDocument,
				resultArray);
}

//*************************************************************************
//
//	PROCEDURE : OnCalculate
//
//	INPUTS : form: the form that holds the controls for this script
//
//	DESCRIPTION : Event handler for the "Calculate" button.  
//
//	OUTPUTS : none
//
//*************************************************************************
function OnCalculate(form) 
{
	inputAArray = new Array
	inputBArray = new Array
	operationResult = new Array
	tempStringA = new String
	tempStringB = new String
	var radix = Number(form.radixTextbox.value)
	var alpha = Number(form.alphaTextbox.value)
	var alphaMinValue = Math.ceil((radix+1)/2);
	var alphaMaxValue = radix - 1;
	var maxOperandLength = 0;
	
	//  open results document
	parent.resultsFrame.document.open();

	//  Open a table for the results
	parent.resultsFrame.document.writeln("<TABLE>");

	//  Validate inputs
	if (operandsAreValid(form))
	{
		//  Get the size of each operand without minus signs
		searchPattern = /-/gi;
		tempStringA = form.inputATextbox.value.replace(searchPattern, "");
		tempStringB = form.inputBTextbox.value.replace(searchPattern, "");
		if (tempStringA.length > tempStringB.length)
			maxOperandLength = tempStringA.length;
		else if (tempStringB.length > tempStringA.length)
			maxOperandLength = tempStringB.length;
		else
			maxOperandLength = tempStringA.length;
	
		//  Convert the inputs from string values to arrays
		sdStringToArray(radix, form.inputATextbox.value, inputAArray, maxOperandLength);
		sdStringToArray(radix, form.inputBTextbox.value, inputBArray, maxOperandLength);
	
		//  Perform the requested operation
		if (form.operation[0].checked  == "1")
		{
			performSDAddition(inputAArray, 
							inputBArray, 
							radix, 
							alpha, 
							parent.resultsFrame.document,
							operationResult); 

		}
		else if (form.operation[1].checked  == "1")
		{
			performSDSubtraction(inputAArray, 
								inputBArray, 
								radix, 
								alpha, 
								parent.resultsFrame.document,
								operationResult); 
		}
	}

	//  Close the table
	parent.resultsFrame.document.writeln("</TABLE>");

	//  close results document
	parent.resultsFrame.document.close();
}


</SCRIPT>
</HEAD>
<BODY BGCOLOR="#945D28">
<FORM NAME="theScript">
<CENTER>
<H2>Signed Digit Arithmetic</H2></CENTER>

<FORM>
<P>
Radix (2-16) : <INPUT name=radixTextbox size=3> 
</P>
<P>Alpha : <INPUT name=alphaTextbox style="HEIGHT: 22px; WIDTH: 156px"> 
</P>

<P>
<i>add <INPUT CHECKED name=operation type=radio> 
subtract <INPUT name=operation type=radio>
</i>
</P>
<P><EM>For inputs, use A-F for digits 10-15</EM></P>

<P>
Input A : <INPUT  name="inputATextbox" style="HEIGHT: 22px; TEXT-TRANSFORM: none; WIDTH: 156px">
</P>

<P>
Input B : <INPUT  name="inputBTextbox" style="HEIGHT: 22px; TEXT-TRANSFORM: none; WIDTH: 156px">
</P>

<CENTER>&nbsp;</CENTER>

<CENTER>
<INPUT type="button" name="compute" value="Compute" onClick="OnCalculate(this.form)"></CENTER>
</FORM>
</BODY>
</HTML>
