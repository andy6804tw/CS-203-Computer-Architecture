<HTML>
<HEAD>
<TITLE> Radix-4 Square Root </TITLE>
<SCRIPT language="JavaScript">



function MakeLine(NumColumns) {
        return "<TR> <TD colspan=" + NumColumns + "> <HR noshade size=1>\n";
}

function PrintError(Message) {
        Error = "<CENTER><H1> ERROR </H1></CENTER> <P>\n"
        Error += "<CENTER> <EM>" + Message + "</EM> </CENTER>\n"
        return Error
}

function ParseBinary (BinNum) {
        // Turns a binary number into a decimal, sets a flag to true if
        // BinNum is not actually binary

        IsNeg = false
        if (BinNum < 0) {
                IsNeg = true
                BinNum *= -1
        }
        RealNum = 0
        LogBaseTen = Math.log(BinNum)/Math.LN10
        HighestPlace = Math.ceil(LogBaseTen)
        for (CurPlace = HighestPlace; CurPlace >= -NumBits; CurPlace--) {
                CurEntry = Math.round(BinNum / Math.pow(10, CurPlace))
                if (CurEntry != 0 && CurEntry != 1) {
                        NotBinary = true
                        CurEntry = 1 // feed it something normal, to avoid
                                         // wierd Javascript errors
                }
                if (CurEntry == 1) {
                        RealNum += Math.pow(2, CurPlace)
                        BinNum -= Math.pow(10, CurPlace)
                }
        }
        if (IsNeg) {RealNum *= -1} // reverse it back at the end

        // now check if the number was negative according to two's complement
        // representation - if it was, set the decimal value to this negative
        // number
        if (HighestPlace == NumBits) {
                RealNum -= Math.pow(2, NumBits)
        }

        return RealNum
}

function OrderOfMagnitude (TheNum) {
        // returns the highest place which has a "1" in TheNum's
        // binary representation

        TheNum += Math.pow(10, -1 - NumBits) // kludge so processor
                                            // won't mess up

        // to account for 2's complement representation...
        TheNum < 0 ? TheNum *= -2 : TheNum *= 2


        LogBaseTwo = Math.log(TheNum)/Math.LN2;
        return Math.floor(LogBaseTwo)
}


function TwosComp(TheNum, NumDecs) {
        StartPlace = OrderOfMagnitude(TheNum)

        // first deal with negative numbers...
        if (TheNum < 0) {TheNum += Math.pow(2, StartPlace)}

        if (StartPlace < 0) {StartPlace = 0}
        // now initialize the string
        S = "";
        for (CurPlace = StartPlace; CurPlace >= -NumDecs; CurPlace--) {
                if (CurPlace == -1) {S += "."}
                CurPower = Math.pow(2, CurPlace);
                if (TheNum >= CurPower) {
                        S += "1";
                        TheNum -= CurPower
                } else {
                        S += "0";
                }
        }
        return S;
}


function RoundOff (TheNum) {
        // returns the value TheNum would have if it were represented by
        // NumDecimals bits after the decimal point
        Scaling = Math.pow(2, NumDecimals)
        return (Math.round(TheNum * Scaling) / Scaling)
}

function PrintTwosComp(TheNum) {

        // first deal with negative numbers...
        StartPlace = OrderOfMagnitude(TheNum)
        if (StartPlace < 0) {StartPlace = 0}
        if (TheNum < 0) {TheNum += Math.pow(2, StartPlace + 1)}

        // now initialize the string
        S = ""
        for (CurPlace = NumCols - NumDecimals - 1; CurPlace > StartPlace; CurPlace--) {
                S += "<TD> "
        }
        for (CurPlace = StartPlace; CurPlace >= -NumDecimals; CurPlace--) {
                S += "<TD> "
                if (CurPlace == -1) {S += "."}
                CurPower = Math.pow(2, CurPlace);
                if (TheNum >= CurPower) {
                        S += "1 "
                        TheNum -= CurPower
                } else {
                        S += "0 "
                }
        }
        return S;
}

function SRT(form) {
        X = parseFloat(form.X.value)
        // Global variables... assigned from within a procedure...

        xlargerd2 = 0;

        NumBits = parseInt(form.NumBits.value) + 0;
        ChoseBin = form.Base[0].checked;
        NotBinary = false;
        if (ChoseBin) {
                X = ParseBinary(X);
        }
        if(form.alpha[0].checked) {
          if(Math.abs(X) >3/8) xlargerd2 = 1;
        }
        
	NumDecimals = NumBits


        NumCols = NumDecimals + 7
        Q = 0;
        X = RoundOff(X)

        TheTop = "<HTML><HEAD><TITLE>Tablet</TITLE></HEAD><BODY bgcolor=white>"
        Middle = "X = " + X + "<P>\n"
        Middle += "<TABLE>"

        r = X
        Middle += "<TR> <TD> r<SUB>0</SUB> = X <TD>";
        Middle += PrintTwosComp(r, OrderOfMagnitude(r) + 1);
        Middle += "<TD>\n"

        for (i = 0; i < NumDecimals/2; i++) {
                Middle += "<TR> <TD> 4r<SUB>" + i + "</SUB> <TD>";
		if(form.alpha[0].checked) {
		if (i==0) 
			{
			if (r > (1/2*Math.pow(4,-i-1)))
				{qi = 2}
			else if (r > (1/16*Math.pow(4,-i-1)))
				{qi = 1}
			else 
				{qi = 0}
			}
		else {
			if (r > (3/4*Q + 3/8*Math.pow(4,-i-1)))
				{qi = 2}
			else if (r >= (1/4*Q+1/8*Math.pow(4,-i-1)))
				{qi = 1}
			else if (r >= -(1/4*Q-1/8*Math.pow(4, -i-1)))
				{qi = 0}
			else if (r >= -(3/4*Q-3/8*Math.pow(4,-i-1)))
				{qi = -1}
			else 
				{
				qi = -2
				}
			}

                Middle += PrintTwosComp(4 * r)
                Middle += "<TD> set q<SUB>" + (i + 1) + "</SUB> = ";
		if (qi == 2)
			{Middle +=qi}
		else if (qi == 1)
			{Middle +=qi}
		else if (qi == 0)
			{Middle +=qi}
		else if (qi == -1)
			{Middle +=qi}
		else if (qi == -2)
			{Middle +=qi}

		if (i == 0)
			{OldQ = 0 }
		else
			{OldQ = Q }       // needed for 2nd line
		Q += Math.pow(4, -i-1) * qi;
               	Middle +=  ", Q<sub>" + (i + 1) + "</sub> = "
		Middle += TwosComp(Q, (i+1)*2) + "\n"
	

                // 2nd line - printed only if qi != 0
                if (qi != 0) {
                        Middle += "<TR> <TD> "
                        if (qi > 0) 
				{Middle += "-"+qi+"("}
			else
				{Middle += "-"+"("+qi+")"+"("}
                        i == 0 ? Middle += "0" : Middle += "2Q<sub>" + i + "</sub>"
			if (qi > 0) 
				{Middle += "+"+qi}
			else 
				{Middle += "+"+"("+qi+")"}
                        Middle += "*4<sup>-" + (i + 1) + "</sup>) <TD>"
                
			Added = - (qi * 2 * OldQ) - qi*qi*Math.pow(4, -(i+1))
                      
                        if (qi >= 1) 
				{Middle += PrintTwosComp(-Added)}
			else
				{Middle += PrintTwosComp(Added)}
			Middle += "<TD>\n"
                        Middle += MakeLine(NumCols + 3)
			
                }

                // 3rd line
                r *= 4
		
		if (Added >= 4)
		  {Added = 4-Added}
				
                if (qi != 0) {r += Added}
                Middle += "<TR> <TD> r<SUB>" + (i + 1) + "</SUB>"
                if (qi == 0) {Middle += " = 4r<sub>" + i + "</sub>"}
                Middle += "<TD> " + PrintTwosComp(r) + "<TD>"
        	}

		else {
		if (i==0) 
			{
			if (r >= 1/2+1/4*Math.pow(4,-i-1)) 
				{qi = 3}
			else if (r >= Math.pow(4,-i-1)) 
				{qi = 2}
			else if (r >= Math.pow(4,-i-2))
				{qi = 1}
			else 
				{qi = 0}
			}
		else {
			if (r >= (3/2*Q+9/4*Math.pow(4,-i-1)))
				{qi = 3}
			else if (r >= (Q + Math.pow(4,-i-1)) )
				{qi = 2}
			else if (r >= (Q/2+Math.pow(4,-i-2)))
				{qi = 1}
			else if (r >= -(Q/2-Math.pow(4, -i-2)))
				{qi = 0}
			else if (r >= -(Q - Math.pow(4,-i-1)))
				{qi = -1}
			else if (r >= -(3/2*Q-9/4*Math.pow(4,-i-1)))
				{qi = -2}
			else 
				{
				qi = -3
				}
			}

                Middle += PrintTwosComp(4 * r)
                Middle += "<TD> set q<SUB>" + (i + 1) + "</SUB> = ";
                if (qi == 3)
			{Middle +=qi}
		else if (qi == 2)
			{Middle +=qi}
		else if (qi == 1)
			{Middle +=qi}
		else if (qi == 0)
			{Middle +=qi}
		else if (qi == -1)
			{Middle +=qi}
		else if (qi == -2)
			{Middle +=qi}
		else if (qi == -3)
			{Middle +=qi}

		if (i == 0)
			{OldQ = 0 }
		else
			{OldQ = Q }       // needed for 2nd line
		Q += Math.pow(4, -i-1) * qi;
               	Middle +=  ", Q<sub>" + (i + 1) + "</sub> = "
		Middle += TwosComp(Q, (i+1)*2) + "\n"
	

                // 2nd line - printed only if qi != 0
                if (qi != 0) {
			Middle += "<TR> <TD> "
                        if (qi > 0) 
				{Middle += "-"+qi+"("}
			else
				{Middle += "-"+"("+qi+")"+"("}
                        i == 0 ? Middle += "0" : Middle += "2Q<sub>" + i + "</sub>"
			if (qi > 0) 
				{Middle += "+"+qi}
			else 
				{Middle += "+"+"("+qi+")"}
                        Middle += "*4<sup>-" + (i + 1) + "</sup>) <TD>"
                
			Added = - (qi * 2 * OldQ) - qi*qi*Math.pow(4, -(i+1))
                      
                        if (qi >= 1) 
				{Middle += PrintTwosComp(-Added)}
			else
				{Middle += PrintTwosComp(Added)}
			Middle += "<TD>\n"
                        Middle += MakeLine(NumCols + 3)
                }

                // 3rd line
                r *= 4
		
		if (Added >= 4)
		  {Added = 4-Added}
				
                if (qi != 0) {r += Added}
                Middle += "<TR> <TD> r<SUB>" + (i + 1) + "</SUB>"
                if (qi == 0) {Middle += " = 4r<sub>" + i + "</sub>"}
                Middle += "<TD> " + PrintTwosComp(r) + "<TD>"
        	}
	}

        Middle += "</TABLE> <P>\n";
        Middle += "Q = " + TwosComp(Q, i*2) + " = " + Q + "<BR>\n"
        Middle += "Real value = " + Math.sqrt(X) + ", error = " +
                Math.abs(Math.sqrt(X) - Q)
        Bottom = "</BODY> </HTML>";

    	if (NumDecimals <= 0)   {Middle = PrintError("Overflow")}
        if (X < 0) {Middle = PrintError("X cannot be negative")}
        if (X >= 1) {Middle = PrintError("X cannot be larger than 1")}
        if (NotBinary) {Middle = PrintError("Non-binary number")}
        if (xlargerd2) {Middle = PrintError("X cannot be larger than 0.375 when alpha=2")}
        
        
   

        parent.frames[1].document.open()
        parent.frames[1].document.write(TheTop);
        parent.frames[1].document.write(Middle);
        parent.frames[1].document.write(Bottom);
        parent.frames[1].document.close()

}


</SCRIPT>
</HEAD>

<BODY bgcolor="#8999DB">

<CENTER> <H3> Radix-4 Square Root</H3>

<p><FORM>
<p><i>Alpha: <EM>2</EM> <INPUT type="radio" name="alpha" value="2">
                 <EM>3</EM> <INPUT type="radio" name="alpha" value="3" checked>
</i><p>
<P>
<EM>bin</EM> <INPUT type="radio" name="Base" value="Binary">
<EM>dec</EM> <INPUT type="radio" name="Base" value="Decimal" checked>
<P>

X: <INPUT type="text" name="X" size=16>
<P>Number of bits:<BR>
<INPUT type="text" name="NumBits" value="9" size=12>
<P>
<center>
<INPUT type="button" name="enter" value="Compute" onClick="SRT(this.form)">
</center>
<P>
<center>
<INPUT type="button" name="enter" value="Help" 
onClick=parent.frames[1].location.href="help4.html">
</CENTER>
</FORM>

</BODY>
</HTML>
