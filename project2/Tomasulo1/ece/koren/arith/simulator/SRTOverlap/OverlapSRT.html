<HTML>
<HEAD>
<TITLE> SRT Divison using Overlapping SRT stages</TITLE>
<SCRIPT language="JavaScript">

function MakeLine(NumColumns) {
    return "<TR> <TD colspan=" + NumColumns + "> <HR noshade size=1>\n";
}

function PrintError(Message) {
    Error = "<CENTER><H1> ERROR </H1></CENTER> <P>\n"
    Error += "<CENTER> <EM>" + Message + "</EM> </CENTER>\n"
    return Error
}

function ParseBinary (BinNum) {
    // Turns a binary number into a decimal, sets a flag to true if
    // BinNum is not actually binary

    IsNeg = false
    if (BinNum < 0) {
        IsNeg = true
        BinNum *= -1
    }
    RealNum = 0
    LogBaseTen = Math.log(BinNum)/Math.LN10
    HighestPlace = Math.ceil(LogBaseTen)
    for (CurPlace = HighestPlace; CurPlace >= -NumBits; CurPlace--) {
        CurEntry = Math.round(BinNum / Math.pow(10, CurPlace))
        if (CurEntry != 0 && CurEntry != 1) {
            NotBinary = true
            CurEntry = 1 // feed it something normal, to avoid
                     // wierd Javascript errors
        }
        if (CurEntry == 1) {
            RealNum += Math.pow(2, CurPlace)
            BinNum -= Math.pow(10, CurPlace)
        }
    }
    if (IsNeg) {RealNum *= -1} // reverse it back at the end

    // now check if the number was negative according to two's complement
    // representation - if it was, set the decimal value to this negative
    // number
    if (HighestPlace == NumBits) {
        RealNum -= Math.pow(2, NumBits)
    }

    return RealNum
}

function OrderOfMagnitude (TheNum) {
    // returns the highest place which has a "1" in TheNum's
    // binary representation

        TheNum += Math.pow(10, -1 - NumBits) // kludge so processor
                                            // won't mess up

    // to account for 2's complement representation...
    TheNum < 0 ? TheNum *= -2 : TheNum *= 2


    LogBaseTwo = Math.log(TheNum)/Math.LN2;
    return Math.floor(LogBaseTwo)
}

function TwosComp(TheNum, StartPlace) {
    NumStarted = false;
    NumDigits = StartPlace + NumDecimals + 1;

    // first deal with negative numbers...
    if (StartPlace < 0) {StartPlace == 0}
    if (TheNum < 0) {TheNum += Math.pow(2, StartPlace + 1)}

    // now initialize the string
    S = "";
    for (TheDigit = 1; TheDigit <= NumDigits; TheDigit++) {
        CurPlace = NumDigits - NumDecimals - TheDigit;
        if (CurPlace == 0) {NumStarted = true}
        if (CurPlace == -1) {S += "."}
        CurPower = Math.pow(2, CurPlace);
        if (TheNum >= CurPower) {
            NumStarted = true;
            S += "1";
            TheNum -= CurPower
        } else if (NumStarted) {
            S += "0";
        } // otherwise, print nothing
    }
    return S;
}

function RoundOff (TheNum) {
    // returns the value TheNum would have if it were represented by
    // NumDecimals bits after the decimal point
    Scaling = Math.pow(2, NumDecimals)
    return (Math.round(TheNum * Scaling) / Scaling)
}

function PrintTwosComp(TheNum, StartPlace,colorize) {

    if (StartPlace < 0) {StartPlace = 0}
    // first deal with negative numbers...
    if (TheNum < 0) {TheNum += Math.pow(2, StartPlace + 1)}

    // now initialize the string
    S = "";
    for (CurPlace = NumCols - NumDecimals; CurPlace > StartPlace; CurPlace--) {
        S += "<TD> "
    }
    if (colorize) S+= "<font color=red>";
    for (CurPlace = StartPlace; CurPlace >= -NumDecimals; CurPlace--) {
        S += "<TD> ";
        if (colorize) S+= "<font color=red>";
        if (CurPlace == -1) {
            S += ".";
        }
        CurPower = Math.pow(2, CurPlace);
        if (TheNum >= CurPower) {
            S += "1 ";
            TheNum -= CurPower
        } else {S += "0 "} 
    }
    return S;
}

function LessHalf(remainder) {
        return Math.abs(remainder) < 1/2;
}

function EqualHalf(remainder) {
        return Math.abs(remainder) == 1/2;
}

function getQi(remainder) {
    lth = LessHalf(remainder);
    lth ? returnval = 0 : remainder / D >= 0 ? returnval = 1 : returnval = -1;
    if (EqualHalf(remainder) && returnval == -1) {returnval = 0;}
    return returnval;


}

function radix4(colorize,LessThanH1,LessThanH2,LessThanH3,rx,rx_qi) {
// function to print comparison and to print the amount to add to generate next remainder
                if (colorize) Middle += "<font color=red>";
                if(LessThanH1) {
                   Middle += (rx >= 0 ? "r < " + sh1 : "r > " + "-" + sh1);
                }
                else if(LessThanH2) {
                   Middle += (rx >= 0 ? sh1 +" <= r < "+sh2 : "-"+sh2 +" < r <= " + "-" + sh1);
                }
                else if(rx) {
                   Middle += (rx >= 0 ? sh2 +" <= r < "+sh3 : "-"+sh3 +" < r <= -"+sh2);
                }
                else {
                   Middle += (rx > 0 ? "r >= "+sh3 : "r < "+ "-"+sh3);
                }

                // Middle += " (r = " + r + ") "
                // if (r1_LessThanHalf) Middle += " (r1_LessThanHalf) "
                // if (EqualsHalf) Middle += " (EqualsHalf) "
                Middle += "    set q<SUB>" + (i + 1) + "</SUB> = ";
                Middle += rx_qi + " &nbsp , ADD " + (0 - rx_qi) + "D\n";
}


function radix2(colorize, r, r_lth, r_eqh, r_qi, stage, text1, text2, text3) {
// function to print comparison and to print the amount to add to generate next remainder
        //r     - remainder
        //r_lth - remainder less than half
        //r_eqh - remainder equal than half
        //r_qi  - q that corresponds with remainder
        //stage - Stage of division

        Middle += "<TR> <TD>"
        if (colorize) {Middle+="<font color=ff0000>"}
        Middle += "Stage" + stage + ": (" + text1 + "<SUB>";
 
        if  (Chose_srt2_4 || Chose_srt4_2) {Middle += bit + "</SUB>" + text2 + "<TD>"}
	else {Middle += i + "</SUB>" + text2 + "<TD>";}                           
        Middle += PrintTwosComp(r, SumSize,colorize);             
        Middle += "\n";                                            
        Middle += " &nbsp &nbsp"                                       
        if (colorize) {Middle+="<font color=red>"}
         if (r_lth) {                                           
         Middle += ((r_qi) >= 0) ? "< 1/2 " : ">= -1/2 "        
         } else {                                               
             if (r_eqh) {                                       
                 Middle += ">= -1/2 "                           
             } else {                                           
                 Middle += ((r_qi) > 0 ? ">= 1/2 " : "< -1/2 ") 
             }                                              
         }                                                  

         Middle += "set q<SUB>" + (i + stage) + "</SUB> = ";    
//       if (colorize) Q += Math.pow(2, -i - stage) * r_qi;                   
         Middle += r_qi;                                    

         Middle += " &nbsp &nbsp ";
         if (colorize) {Middle+="<font color=ff0000>"}
         if      (r_qi == -1) {Middle += "ADD D"}
         else if (r_qi ==  0) {Middle += "ADD 0"}
         else if (r_qi ==  1) {Middle += "ADD -D"}

         {Middle+="<font color=ffffff>"}
}

function SRT(form) {
    X = parseFloat(form.X.value)
    D = parseFloat(form.D.value)

    csa_dly   = parseFloat(form.csa_dly.value);
    mux3_dly  = parseFloat(form.mux3_dly.value);
    mux7_dly  = parseFloat(form.mux7_dly.value);
    mux15_dly = parseFloat(form.mux15_dly.value);
    qsel2_dly = parseFloat(form.q2sel_dly.value);
    qsel4_dly = parseFloat(form.q4sel_dly.value);


    // Global variables... assigned from within a procedure...
    // JavaScript is pretty cool!

    NumBits = parseInt(form.NumBits.value)
    ChoseBin = form.Base[0].checked
    NotBinary = false
    if (ChoseBin) {
        X = ParseBinary(X)
        D = ParseBinary(D)
    }
    Chose_srt2_2      = form.srt_type[0].checked
    Chose_srt2_2_2    = form.srt_type[1].checked
    Chose_srt2_4      = form.srt_type[2].checked
    Chose_srt4_2      = form.srt_type[3].checked
    Chose_srt2_2_2_2  = form.srt_type[4].checked
    Chose_srt4_4      = form.srt_type[5].checked


    if (Chose_srt2_2)      {
        radix = 4; 
        bits_per_iteration = 2;
    }
    else if (Chose_srt2_2_2) {
        radix = 8; 
        bits_per_iteration = 3;
    } 
    else if (Chose_srt2_2_2_2) {
        radix = 16;
        bits_per_iteration = 4
    }
     
    NumDigits = Math.max(OrderOfMagnitude(X), OrderOfMagnitude(D)) + 1
    if (NumDigits < 1) {NumDigits = 1}
    NumDecimals = NumBits - NumDigits
    NumCols = NumDecimals + NumDigits

    TheTop = "<HTML><HEAD><TITLE>Tablet</TITLE></HEAD><BODY bgcolor=white>"
    X = RoundOff(X)
    D = RoundOff(D)
    Middle = "X = " + X + ", D = " + D + "<P>\n"
    Middle = "<TABLE>"



    Q = 0;
    r = X;
    ZeroRem = false

if (Chose_srt2_2 || Chose_srt2_2_2 || Chose_srt2_2_2_2)
{

    Middle += "<TR> <TD> r<SUB>0</SUB> = X <TD>";
    Middle += PrintTwosComp(r, OrderOfMagnitude(r) + 1);
    Middle += "<TD>\n"

    iteration = 1;

     
    for (i = 0; i < NumDecimals; i+=bits_per_iteration) {
        Middle += MakeLine(NumCols + 3);
        Middle += "<TR><TD><B>Iteration " + iteration + "</B>";
        iteration++;

        // "qi" is a horrible misnomer because its actually
        // q(i + 1).


        //For 1st stage
        r1     = 2 * r;
        r1_lth = LessHalf(r1);
        r1_eqh = EqualHalf(r1);
        r1_qi  = getQi(r1);
        qi     = r1_qi;




        //For 2nd stage
        //(2r - D) * 2
        r2_m      = (2 * r - D) * 2
        r2_m_lth  = LessHalf(r2_m);
        r2_m_eqh  = EqualHalf(r2_m);
        r2_m_qi   = getQi(r2_m);

        //(2r) * 2
        r2      = (2 * r) * 2;
        r2_lth  = LessHalf(r2);
        r2_eqh  = EqualHalf(r2);
        r2_qi   = getQi(r2);

        //(2r + D) * 2
        r2_p      = (2 * r + D) * 2;
        r2_p_lth  = LessHalf(r2_p);
        r2_p_eqh  = EqualHalf(r2_p);
        r2_p_qi   = getQi(r2_p);




        //For 3rd stage
        //(4r - 3D) * 2
        r3_m3      = (8 * r - 6 * D);
        r3_m3_lth  = LessHalf(r3_m3);
        r3_m3_eqh  = EqualHalf(r3_m3);
        r3_m3_qi   = getQi(r3_m3);

        //(4r - 2D) * 2
        r3_m2      = (8 * r - 4 * D);
        r3_m2_lth  = LessHalf(r3_m2);
        r3_m2_eqh  = EqualHalf(r3_m2);
        r3_m2_qi   = getQi(r3_m2);

        //(4r - 1D) * 2
        r3_m1      = (8 * r - 2 * D);
        r3_m1_lth  = LessHalf(r3_m1);
        r3_m1_eqh  = EqualHalf(r3_m1);
        r3_m1_qi   = getQi(r3_m1);

        //(4r ) * 2
        r3      = (8 * r);
        r3_lth  = LessHalf(r3);
        r3_eqh  = EqualHalf(r3);
        r3_qi   = getQi(r3);

        //(4r + 1d ) * 2
        r3_p1      = (8 * r + 2 * D);
        r3_p1_lth  = LessHalf(r3_p1);
        r3_p1_eqh  = EqualHalf(r3_p1);
        r3_p1_qi   = getQi(r3_p1);

        //(4r + 2d ) * 2
        r3_p2      = (8 * r + 4 * D);
        r3_p2_lth  = LessHalf(r3_p2);
        r3_p2_eqh  = EqualHalf(r3_p2);
        r3_p2_qi   = getQi(r3_p2);

        //(4r + 3d ) * 2
        r3_p3      = (8 * r + 6 * D);
        r3_p3_lth  = LessHalf(r3_p3);
        r3_p3_eqh  = EqualHalf(r3_p3);
        r3_p3_qi   = getQi(r3_p3);




        //For 4th stage
        //(8r - 7D) * 2
        r4_m7      = (8 * r - 7 * D) * 2;
        r4_m7_lth  = LessHalf(r4_m7);
        r4_m7_eqh  = EqualHalf(r4_m7);
        r4_m7_qi   = getQi(r4_m7);

        //(8r - 6D) * 2
        r4_m6      = (8 * r - 6 * D) * 2;
        r4_m6_lth  = LessHalf(r4_m6);
        r4_m6_eqh  = EqualHalf(r4_m6);
        r4_m6_qi   = getQi(r4_m6);

        //(8r - 5D) * 2
        r4_m5      = (8 * r - 5 * D) * 2;
        r4_m5_lth  = LessHalf(r4_m5);
        r4_m5_eqh  = EqualHalf(r4_m5);
        r4_m5_qi   = getQi(r4_m5);

        //(8r - 4D) * 2
        r4_m4      = (8 * r - 4 * D) * 2;
        r4_m4_lth  = LessHalf(r4_m4);
        r4_m4_eqh  = EqualHalf(r4_m4);
        r4_m4_qi   = getQi(r4_m4);

        //(8r - 3D) * 2
        r4_m3      = (8 * r - 3 * D) * 2;
        r4_m3_lth  = LessHalf(r4_m3);
        r4_m3_eqh  = EqualHalf(r4_m3);
        r4_m3_qi   = getQi(r4_m3);

        //(8r - 2D) * 2
        r4_m2      = (8 * r - 2 * D) * 2;
        r4_m2_lth  = LessHalf(r4_m2);
        r4_m2_eqh  = EqualHalf(r4_m2);
        r4_m2_qi   = getQi(r4_m2);

        //(8r - 1D) * 2
        r4_m1      = (8 * r - 1 * D) * 2;
        r4_m1_lth  = LessHalf(r4_m1);
        r4_m1_eqh  = EqualHalf(r4_m1);
        r4_m1_qi   = getQi(r4_m1);

        //(8r ) * 2
        r4      = (8 * r) * 2;
        r4_lth  = LessHalf(r4);
        r4_eqh  = EqualHalf(r4);
        r4_qi   = getQi(r4);

        //(8r + 1d ) * 2
        r4_p1      = (8 * r + 1 * D) * 2;
        r4_p1_lth  = LessHalf(r4_p1);
        r4_p1_eqh  = EqualHalf(r4_p1);
        r4_p1_qi   = getQi(r4_p1);

        //(8r + 2d ) * 2
        r4_p2      = (8 * r + 2 * D) * 2;
        r4_p2_lth  = LessHalf(r4_p2);
        r4_p2_eqh  = EqualHalf(r4_p2);
        r4_p2_qi   = getQi(r4_p2);

        //(8r + 3d ) * 2
        r4_p3      = (8 * r + 3 * D) * 2;
        r4_p3_lth  = LessHalf(r4_p3);
        r4_p3_eqh  = EqualHalf(r4_p3);
        r4_p3_qi   = getQi(r4_p3);

        //(8r + 4D) * 2
        r4_p4      = (8 * r + 4 * D) * 2;
        r4_p4_lth  = LessHalf(r4_p4);
        r4_p4_eqh  = EqualHalf(r4_p4);
        r4_p4_qi   = getQi(r4_p4);

        //(8r + 5D) * 2
        r4_p5      = (8 * r + 5 * D) * 2;
        r4_p5_lth  = LessHalf(r4_p5);
        r4_p5_eqh  = EqualHalf(r4_p5);
        r4_p5_qi   = getQi(r4_p5);

        //(8r + 6D) * 2
        r4_p6      = (8 * r + 6 * D) * 2;
        r4_p6_lth  = LessHalf(r4_p6);
        r4_p6_eqh  = EqualHalf(r4_p6);
        r4_p6_qi   = getQi(r4_p6);

        //(8r + 7D) * 2
        r4_p7      = (8 * r + 7 * D) * 2;
        r4_p7_lth  = LessHalf(r4_p7);
        r4_p7_eqh  = EqualHalf(r4_p7);
        r4_p7_qi   = getQi(r4_p7);


        SumSize = Math.max (OrderOfMagnitude(2 * r),
                            OrderOfMagnitude(D * r1_qi * -1),
                            OrderOfMagnitude(2 * r - r1_qi * D));


        //----------------------------------------------------------
        //Stage1
        radix2(1, r1, r1_lth,r1_eqh,r1_qi,1, "2r" , ")");
        Q += Math.pow(2, -i - 1) * r1_qi;                   

        //Print remainder of first stage                               
        if ((i+1) >= NumDecimals)
        {
            temp_r = RoundOff(2 * r - qi * D);                          
            Middle += "<TR> <TD> r<SUB>" + (i + 1) + "</SUB> "             
            Middle += "<TD> " + PrintTwosComp(temp_r, SumSize) + "<TD>"    
            Middle += "<TD>\n"                                             
        }                 
        //-----------------------------------------------------------  



        //-----------------------------------------------------------
        //Stage2
        if ((i+1) < NumDecimals && radix >=4) 
        {

            if      (qi == 1)  qi_plus_1 = r2_m_qi;
            else if (qi == 0)  qi_plus_1 = r2_qi  ;
            else if (qi == -1) qi_plus_1 = r2_p_qi;

            select = qi; 
            if (select ==  1) radix2(1, r2_m, r2_m_lth,r2_m_eqh,r2_m_qi,2, "2*(2r", "-D))"); 
            if (select ==  0) radix2(1, r2,   r2_lth  ,r2_eqh  ,r2_qi  ,2, "2*(2r", "))"  );
            if (select == -1) radix2(1, r2_p, r2_p_lth,r2_p_eqh,r2_p_qi,2, "2*(2r", "+D))");

            if (select !=  1) radix2(0, r2_m, r2_m_lth,r2_m_eqh,r2_m_qi,2, "2*(2r", "-D))");
            if (select !=  0) radix2(0, r2,   r2_lth  ,r2_eqh  ,r2_qi  ,2, "2*(2r", "))"  );
            if (select != -1) radix2(0, r2_p, r2_p_lth,r2_p_eqh,r2_p_qi,2, "2*(2r", "+D))");

            Q += Math.pow(2, -i - 2) * qi_plus_1;
            tempr = RoundOff(2 * r - qi * D);
            tempr = RoundOff(2 * tempr - qi_plus_1 * D) 

            if (radix <=4 || (i+2 >= NumDecimals))
            { 
                Middle += "<TR> <TD> r<SUB>" + (i + 2) + "</SUB> = ("
                if ( !(i+2 >= NumDecimals))
                {
                    if (select == 1)  Middle += "2*(2r<SUB>" + i + "</SUB>-D))";
                    if (select == 0)  Middle += "2*(2r<SUB>" + i + "</SUB>))";
                    if (select == -1) Middle += "2*(2r<SUB>" + i + "</SUB>+D))";
                    if      (qi_plus_1 == -1) {Middle += "+D";}
                    else if (qi_plus_1 ==  1) {Middle += "-D";}
                }


                //Print remainder of second stage                               
                r = tempr;
                Middle += "<TD> " + PrintTwosComp(tempr, SumSize) + "<TD>"
                Middle += "<TD>\n"
            }

        }
        if (radix <=4 || (i+2 >= NumDecimals)) { r = tempr;}


        //-----------------------------------------------------------
        //Stage3
        //
        //

        if ((i+2) < NumDecimals && radix >=8) 
        {

            select= qi_plus_1 + 2 * qi; 
            if      (select ==  3) qi_plus_2 = r3_m3_qi;
            else if (select ==  2) qi_plus_2 = r3_m2_qi;
            else if (select ==  1) qi_plus_2 = r3_m1_qi;
            else if (select ==  0) qi_plus_2 = r3_qi;
            else if (select == -1) qi_plus_2 = r3_p1_qi;
            else if (select == -2) qi_plus_2 = r3_p2_qi;
            else if (select == -3) qi_plus_2 = r3_p3_qi;
    
            if (select ==  3) radix2(1, r3_m3, r3_m3_lth, r3_m3_eqh, r3_m3_qi, 3, "2*(4r", "-3D))");
            if (select ==  2) radix2(1, r3_m2, r3_m2_lth, r3_m2_eqh, r3_m2_qi, 3, "2*(4r", "-2D))");
            if (select ==  1) radix2(1, r3_m1, r3_m1_lth, r3_m1_eqh, r3_m1_qi, 3, "2*(4r", "-1D))");
            if (select ==  0) radix2(1, r3   , r3_lth   , r3_eqh   , r3_qi   , 3, "2*(4r", "))"   );
            if (select == -1) radix2(1, r3_p1, r3_p1_lth, r3_p1_eqh, r3_p1_qi, 3, "2*(4r", "+1D))");
            if (select == -2) radix2(1, r3_p2, r3_p2_lth, r3_p2_eqh, r3_p2_qi, 3, "2*(4r", "+2D))");
            if (select == -3) radix2(1, r3_p3, r3_p3_lth, r3_p3_eqh, r3_p3_qi, 3, "2*(4r", "+3D))");
                            
            if (select !=  3) radix2(0, r3_m3, r3_m3_lth, r3_m3_eqh, r3_m3_qi, 3, "2*(4r", "-3D))");
            if (select !=  2) radix2(0, r3_m2, r3_m2_lth, r3_m2_eqh, r3_m2_qi, 3, "2*(4r", "-2D))");
            if (select !=  1) radix2(0, r3_m1, r3_m1_lth, r3_m1_eqh, r3_m1_qi, 3, "2*(4r", "-1D))");
            if (select !=  0) radix2(0, r3   , r3_lth   , r3_eqh   , r3_qi   , 3, "2*(4r", "))"   );
            if (select != -1) radix2(0, r3_p1, r3_p1_lth, r3_p1_eqh, r3_p1_qi, 3, "2*(4r", "+1D))");
            if (select != -2) radix2(0, r3_p2, r3_p2_lth, r3_p2_eqh, r3_p2_qi, 3, "2*(4r", "+2D))");
            if (select != -3) radix2(0, r3_p3, r3_p3_lth, r3_p3_eqh, r3_p3_qi, 3, "2*(4r", "+3D))");

            Q += Math.pow(2, -i - 3) * qi_plus_2;
            tempr = RoundOff(2 * r     - qi        * D);
            tempr = RoundOff(2 * tempr - qi_plus_1 * D);
            tempr = RoundOff(2 * tempr - qi_plus_2 * D);

            if (radix <= 8 || (radix > 4 && i + 3 >= NumDecimals)) {
                r = tempr;
                Middle += "<TR> <TD> r<SUB>" + (i + 3) + "</SUB>";
                if ( !(i+3 >= NumDecimals))
                {
                    Middle += " = (";
                    if      (select ==  3)  Middle += "2*(4r<SUB>" + i + "</SUB>-3D))";
                    else if (select ==  2)  Middle += "2*(4r<SUB>" + i + "</SUB>-2D))";
                    else if (select ==  1)  Middle += "2*(4r<SUB>" + i + "</SUB>-1D))";
                    else if (select ==  0)  Middle += "2*(4r<SUB>" + i + "</SUB>))";
                    else if (select == -1)  Middle += "2*(4r<SUB>" + i + "</SUB>+1D))";
                    else if (select == -2)  Middle += "2*(4r<SUB>" + i + "</SUB>+2D))";
                    else if (select == -3)  Middle += "2*(4r<SUB>" + i + "</SUB>+3D))";

                    if      (qi_plus_2 == -1) {Middle += "+D";}
                    else if (qi_plus_2 ==  1) {Middle += "-D";}
                }

                //Print remainder of third stage                               
                Middle += "<TD> " + PrintTwosComp(tempr, SumSize) + "<TD>";
                Middle += "<TD>\n";
            }
        }
        if (radix <= 8 || (i + 3 >= NumDecimals)) { r = tempr;}

        //-----------------------------------------------------------
        //Stage4
        //
        //

        if ((i+3) < NumDecimals && radix >=16) 
        {
            select= qi_plus_2 + 2 * qi_plus_1 + 4 * qi; 

            if (select ==  7) radix2(1, r4_m7, r4_m7_lth, r4_m7_eqh, r4_m7_qi, 4, "2*(8r", "-7D))", "");
            if (select ==  6) radix2(1, r4_m6, r4_m6_lth, r4_m6_eqh, r4_m6_qi, 4, "2*(8r", "-6D))", "");
            if (select ==  5) radix2(1, r4_m5, r4_m5_lth, r4_m5_eqh, r4_m5_qi, 4, "2*(8r", "-5D))", "");
            if (select ==  4) radix2(1, r4_m4, r4_m4_lth, r4_m4_eqh, r4_m4_qi, 4, "2*(8r", "-4D))", "");
            if (select ==  3) radix2(1, r4_m3, r4_m3_lth, r4_m3_eqh, r4_m3_qi, 4, "2*(8r", "-3D))", "");
            if (select ==  2) radix2(1, r4_m2, r4_m2_lth, r4_m2_eqh, r4_m2_qi, 4, "2*(8r", "-2D))", "");
            if (select ==  1) radix2(1, r4_m1, r4_m1_lth, r4_m1_eqh, r4_m1_qi, 4, "2*(8r", "-1D))", "");
            if (select ==  0) radix2(1, r4   , r4_lth   , r4_eqh   , r4_qi   , 4, "2*(8r", "))"   , "");
            if (select == -1) radix2(1, r4_p1, r4_p1_lth, r4_p1_eqh, r4_p1_qi, 4, "2*(8r", "+1D))", "");
            if (select == -2) radix2(1, r4_p2, r4_p2_lth, r4_p2_eqh, r4_p2_qi, 4, "2*(8r", "+2D))", "");
            if (select == -3) radix2(1, r4_p3, r4_p3_lth, r4_p3_eqh, r4_p3_qi, 4, "2*(8r", "+3D))", "");
            if (select == -4) radix2(1, r4_p4, r4_p4_lth, r4_p4_eqh, r4_p4_qi, 4, "2*(8r", "+4D))", "");
            if (select == -5) radix2(1, r4_p5, r4_p5_lth, r4_p5_eqh, r4_p5_qi, 4, "2*(8r", "+5D))", "");
            if (select == -6) radix2(1, r4_p6, r4_p6_lth, r4_p6_eqh, r4_p6_qi, 4, "2*(8r", "+6D))", "");
            if (select == -7) radix2(1, r4_p6, r4_p7_lth, r4_p7_eqh, r4_p7_qi, 4, "2*(8r", "+7D))", "");


            if (select !=  7) radix2(0, r4_m7, r4_m7_lth, r4_m7_eqh, r4_m7_qi, 4, "2*(8r", "-7D))", "");
            if (select !=  6) radix2(0, r4_m6, r4_m6_lth, r4_m6_eqh, r4_m6_qi, 4, "2*(8r", "-6D))", "");
            if (select !=  5) radix2(0, r4_m5, r4_m5_lth, r4_m5_eqh, r4_m5_qi, 4, "2*(8r", "-5D))", "");
            if (select !=  4) radix2(0, r4_m4, r4_m4_lth, r4_m4_eqh, r4_m4_qi, 4, "2*(8r", "-4D))", "");
            if (select !=  3) radix2(0, r4_m3, r4_m3_lth, r4_m3_eqh, r4_m3_qi, 4, "2*(8r", "-3D))", "");
            if (select !=  2) radix2(0, r4_m2, r4_m2_lth, r4_m2_eqh, r4_m2_qi, 4, "2*(8r", "-2D))", "");
            if (select !=  1) radix2(0, r4_m1, r4_m1_lth, r4_m1_eqh, r4_m1_qi, 4, "2*(8r", "-1D))", "");
            if (select !=  0) radix2(0, r4   , r4_lth   , r4_eqh   , r4_qi   , 4, "2*(8r", "))"   , "");
            if (select != -1) radix2(0, r4_p1, r4_p1_lth, r4_p1_eqh, r4_p1_qi, 4, "2*(8r", "+1D))", "");
            if (select != -2) radix2(0, r4_p2, r4_p2_lth, r4_p2_eqh, r4_p2_qi, 4, "2*(8r", "+2D))", "");
            if (select != -3) radix2(0, r4_p3, r4_p3_lth, r4_p3_eqh, r4_p3_qi, 4, "2*(8r", "+3D))", "");
            if (select != -4) radix2(0, r4_p4, r4_p4_lth, r4_p4_eqh, r4_p4_qi, 4, "2*(8r", "+4D))", "");
            if (select != -5) radix2(0, r4_p5, r4_p5_lth, r4_p5_eqh, r4_p5_qi, 4, "2*(8r", "+5D))", "");
            if (select != -6) radix2(0, r4_p6, r4_p6_lth, r4_p6_eqh, r4_p6_qi, 4, "2*(8r", "+6D))", "");
            if (select != -7) radix2(0, r4_p6, r4_p7_lth, r4_p7_eqh, r4_p7_qi, 4, "2*(8r", "+7D))", "");

            if      (select ==  7) qi_plus_3 = r4_m7_qi;
            else if (select ==  6) qi_plus_3 = r4_m6_qi;
            else if (select ==  5) qi_plus_3 = r4_m5_qi;
            else if (select ==  4) qi_plus_3 = r4_m4_qi;
            else if (select ==  3) qi_plus_3 = r4_m3_qi;
            else if (select ==  2) qi_plus_3 = r4_m2_qi;
            else if (select ==  1) qi_plus_3 = r4_m1_qi;
            else if (select ==  0) qi_plus_3 = r4_qi;
            else if (select == -1) qi_plus_3 = r4_p1_qi;
            else if (select == -2) qi_plus_3 = r4_p2_qi;
            else if (select == -3) qi_plus_3 = r4_p3_qi;
            else if (select == -4) qi_plus_3 = r4_p4_qi;
            else if (select == -5) qi_plus_3 = r4_p5_qi;
            else if (select == -6) qi_plus_3 = r4_p6_qi;
            else if (select == -7) qi_plus_3 = r4_p7_qi;

            Q += Math.pow(2, -i - 4) * qi_plus_3;

            tempr = RoundOff(2 * r     - qi        * D);
            tempr = RoundOff(2 * tempr - qi_plus_1 * D);
            tempr = RoundOff(2 * tempr - qi_plus_2 * D);
            r     = RoundOff(2 * tempr - qi_plus_3 * D);

            //Print remainder of forth stage                               
            Middle += "<TR> <TD> r<SUB>" + (i + 4) + "</SUB>"
            if ( !(i+4 >= NumDecimals))
            {
                Middle += " = (";
                if      (select ==  7)  Middle += "2*(8r<SUB>" + i + "</SUB>-7D))";
                else if (select ==  6)  Middle += "2*(8r<SUB>" + i + "</SUB>-6D))";
                else if (select ==  5)  Middle += "2*(8r<SUB>" + i + "</SUB>-5D))";
                else if (select ==  4)  Middle += "2*(8r<SUB>" + i + "</SUB>-4D))";
                else if (select ==  3)  Middle += "2*(8r<SUB>" + i + "</SUB>-3D))";
                else if (select ==  2)  Middle += "2*(8r<SUB>" + i + "</SUB>-2D))";
                else if (select ==  1)  Middle += "2*(8r<SUB>" + i + "</SUB>-1D))";
                else if (select ==  0)  Middle += "2*(8r<SUB>" + i + "</SUB>))";
                else if (select == -1)  Middle += "2*(8r<SUB>" + i + "</SUB>+1D))";
                else if (select == -2)  Middle += "2*(8r<SUB>" + i + "</SUB>+2D))";
                else if (select == -3)  Middle += "2*(8r<SUB>" + i + "</SUB>+3D))";
                else if (select == -4)  Middle += "2*(8r<SUB>" + i + "</SUB>+4D))";
                else if (select == -5)  Middle += "2*(8r<SUB>" + i + "</SUB>+5D))";
                else if (select == -6)  Middle += "2*(8r<SUB>" + i + "</SUB>+6D))";
                else if (select == -7)  Middle += "2*(8r<SUB>" + i + "</SUB>+7D))";

                if      (qi_plus_3 == -1) {Middle += "+D";}
                else if (qi_plus_3 ==  1) {Middle += "-D";}
            }


            Middle += "<TD> " + PrintTwosComp(tempr, SumSize) + "<TD>"
            Middle += "<TD>\n"
        }

    }

    Middle += "</TABLE> <P>\n";
    Middle += "Q = " + TwosComp(Q, 0) + " = " + Q + "<BR>\n"
    if (r/D < 0) { // if sign is different
        ulp = Math.pow(2, -NumDecimals)
        Middle += "R<i><sub>corrected</sub></i> = r<sub>" + i + "</sub>"
        if (Q/D > 0 || ZeroRem) {
            Middle += " + D = " + TwosComp(r, 0) + " + " +
            TwosComp(D, 0) + " = " + TwosComp(r + D, 0) + " = " +
            (r + D) + "<BR>\n"
            Middle += "Q<i><sub>corrected</sub></i> = Q - <i>ulp</i> = " +
            TwosComp(Q, 0) + " - " + TwosComp(ulp, 0) + " = " +
            TwosComp(Q - ulp, 0) + " = " + (Q - ulp)
        } else {
            Middle += " - D = " + TwosComp(r, 3) + " - " +
            TwosComp(D, 0) + " = " + TwosComp(r - D, 0) + " = " +
            (r - D) + "<BR>\n"
            Middle += "Q<i><sub>corrected</sub></i> = Q + <i>ulp</i> = " +
            TwosComp(Q, 0) + " + " + TwosComp(ulp, 3) + " = " +
            TwosComp(Q + ulp, 0) + " = " + (Q + ulp)
        }

    }

    //calculate delays through circuit
    if (Chose_srt2_2)
    {
      d1 = qsel2_dly + mux3_dly + csa_dly + csa_dly;
      d2 = csa_dly + qsel2_dly + mux3_dly + mux3_dly + csa_dly;

      
      Middle += "<br>Total iterations needed is " + (i/2);
      if (d1 > d2)
      {
           Middle += "<br>Delay through circuit is " + d1 ;
           Middle += "<br>Critical path is through qsel, mux, csa, csa";
           Middle += "<br>Total delay until final quotient is generated: " + (d1* (i/2));
      }
      else
      {
           Middle += "<br>Delay through circuit is " + d2 ;
           Middle += "<br>critical path is through csa, qsel, mux3, mux3";
           Middle += "<br>Total delay until final quotient is generated: " + (d2* (i/2));
      }
    }
    else if (Chose_srt2_2_2)
    {
      Middle += "<br>Total iterations needed is " + (i/3);
      d1 = qsel2_dly + mux3_dly + csa_dly + csa_dly + csa_dly;
      d2 = qsel2_dly + mux3_dly + mux7_dly + mux3_dly + csa_dly;
      d3 = csa_dly + qsel2_dly + mux7_dly + mux3_dly + csa_dly;

      if ((d1 >= d2) && (d1>=d3))
      {
           Middle += "<br>\nDelay through circuit is " + d1 ;
           Middle += "<br>Critical path is through qsel, mux3, csa, csa, csa";
           Middle += "<br>Total delay until final quotient is generated: " + (d1* (i/3));
      }
      else if ((d2 >= d1) && (d2>=d3))
      {
           Middle += "<br>Delay through circuit is " + d2 ;
           Middle += "<br>critical path is through qsel, mux3, mux7, mux3, csa";
           Middle += "<br>Total delay until final quotient is generated: " + (d2* (i/3));
      }
      else
      {
           Middle += "<br>Delay through circuit is " + d3 ;
           Middle += "<br>critical path is through csa, qsel, mux7, mux3, csa";
           Middle += "<br>Total delay until final quotient is generated: " + (d3* (i/3));
      }

    }
    else if (Chose_srt2_2_2_2)
    {
      Middle += "<br>Total iterations needed is " + (i/4);
      d1 = qsel2_dly + mux3_dly + csa_dly + csa_dly + csa_dly + csa_dly;
      d2 = qsel2_dly + mux3_dly + mux15_dly + mux3_dly + csa_dly;
      d3 = csa_dly + qsel2_dly + mux15_dly + mux3_dly + csa_dly;

      if ((d1 >= d2) && (d1>=d3))
      {
           Middle += "<br>\nDelay through circuit is " + d1 ;
           Middle += "<br>Critical path is through qsel, mux3, csa, csa, csa, csa";
           Middle += "<br>Total delay until final quotient is generated: " + (d1* (i/4));
      }
      else if ((d2 >= d1) && (d2>=d3))
      {
           Middle += "<br>Delay through circuit is " + d2 ;
           Middle += "<br>critical path is through qsel, mux3, mux15, mux3, csa";
           Middle += "<br>Total delay until final quotient is generated: " + (d2* (i/4));
      }
      else
      {
           Middle += "<br>Delay through circuit is " + d3 ;
           Middle += "<br>critical path is through csa, qsel, mux15, mux3, csa";
           Middle += "<br>Total delay until final quotient is generated: " + (d3* (i/4));
      }
    }



    Bottom = "</BODY> </HTML>";
}

else if (Chose_srt4_4)
{
        SumSize = Math.max (OrderOfMagnitude(4 *  r),
                            OrderOfMagnitude(16 * r - 12* D),
                            OrderOfMagnitude(16 * r - 8 * D),
                            OrderOfMagnitude(16 * r - 4 * D),
                            OrderOfMagnitude(16 * r - 0 * D),
                            OrderOfMagnitude(16 * r - 4 * D),
                            OrderOfMagnitude(16 * r - 8 * D),
                            OrderOfMagnitude(16 * r - 12* D),
                            OrderOfMagnitude(16 * r + 12* D),
                            OrderOfMagnitude(16 * r + 8 * D),
                            OrderOfMagnitude(16 * r + 4 * D),
                            OrderOfMagnitude(16 * r + 0 * D),
                            OrderOfMagnitude(16 * r + 4 * D),
                            OrderOfMagnitude(16 * r + 8 * D),
                            OrderOfMagnitude(16 * r + 12* D))

        Middle += "<TR> <TD> r<SUB>0</SUB> = X <TD>";
        Middle += PrintTwosComp(r, SumSize);
        Middle += "<TD>\n"
        NumDec_4 = Math.floor(NumDecimals/2);

        if(D < 0.625) {k1 = 0.25; sk1="0.010"}
        else {k1 = 0.375;sk1="0.011"}

        if(D < 0.5625) { k2 = 0.75;sk2="0.110"}
        else if(D < 0.625) { k2 = 0.875;sk2="0.111"}
        else if(D < 0.6875) {k2 = 1;sk2="1.000"}
        else if(D < 0.75) { k2 = 1.125;sk2="1.001"}
        else if(D < 0.875) { k2 = 1.25;sk2="1.010"}
        else if(D < 0.9375) {k2 = 1.375;sk2="1.011"}
        else {k2 = 1.5;sk2="1.100"}


        h1 = 0.5; sh1="0.1"
        h2 = 1.0; sh2="1.0"
        if(D < 0.75) { h3 = 1.5; sh3="1.1"}
        else {h3 = 2;sh3="10.0"}

        iteration = 1;

        for (i = 0; i < NumDec_4; i+=2) {
                Middle += MakeLine(NumCols + 5);
                Middle += "<TR><TD><B>Iteration " + iteration + "</B>";
                iteration++;


                // "qi" is a horrible misnomer because its actually
                // q(i + 1).
                  r1 = 4 * r;

                  //Calculate first partial remainder
                  r1_LessThanK1 = Math.abs(r1) < k1
                  r1_LessThanK2 = Math.abs(r1) < k2
                  r1_LessThanH3 = Math.abs(r1) < h3;
                  r1_LessThanH2 = Math.abs(r1) < h2;
                  r1_LessThanH1 = Math.abs(r1) < h1;
  
                
                  if(r1_LessThanH1) { r1_qi = 0;}
                  else if(r1_LessThanH2) {
                      r/D >= 0 ? r1_qi = 1: r1_qi = -1;
                  }
                  else if (r1_LessThanH3) {
                      r/D >= 0 ? r1_qi = 2: r1_qi = -2;
                  }
                  else {
                      r/D >= 0 ? r1_qi = 3: r1_qi = -3;
                  }

                  //Calculate all second partial remainders
                  // (4R-3D)*4 = 16R-12D
                  // (4R-2D)*4 = 16R- 8D
                  // (4R-1D)*4 = 16R- 4D
                  // (4R   )*4 = 16R
                  // (4R+1D)*4 = 16R+ 4D
                  // (4R+2D)*4 = 16R+ 8D
                  // (4R+3D)*4 = 16R+12D

                  r2_m3 = 16*r -12*D;
                  r2_m2 = 16*r - 8*D;
                  r2_m1 = 16*r - 4*D;
                  r2    = 16*r      ;
                  r2_p1 = 16*r + 4*D;
                  r2_p2 = 16*r + 8*D;
                  r2_p3 = 16*r +12*D;

                  r2_m3_LessThanK1 = Math.abs(r2_m3) < k1
                  r2_m3_LessThanK2 = Math.abs(r2_m3) < k2
                  r2_m3_LessThanH3 = Math.abs(r2_m3) < h3;
                  r2_m3_LessThanH2 = Math.abs(r2_m3) < h2;
                  r2_m3_LessThanH1 = Math.abs(r2_m3) < h1;
                
                  r2_m2_LessThanK1 = Math.abs(r2_m2) < k1
                  r2_m2_LessThanK2 = Math.abs(r2_m2) < k2
                  r2_m2_LessThanH3 = Math.abs(r2_m2) < h3;
                  r2_m2_LessThanH2 = Math.abs(r2_m2) < h2;
                  r2_m2_LessThanH1 = Math.abs(r2_m2) < h1;
  
                  r2_m1_LessThanK1 = Math.abs(r2_m1) < k1
                  r2_m1_LessThanK2 = Math.abs(r2_m1) < k2
                  r2_m1_LessThanH3 = Math.abs(r2_m1) < h3;
                  r2_m1_LessThanH2 = Math.abs(r2_m1) < h2;
                  r2_m1_LessThanH1 = Math.abs(r2_m1) < h1;
  
                  r2_LessThanK1 = Math.abs(r2) < k1
                  r2_LessThanK2 = Math.abs(r2) < k2
                  r2_LessThanH3 = Math.abs(r2) < h3;
                  r2_LessThanH2 = Math.abs(r2) < h2;
                  r2_LessThanH1 = Math.abs(r2) < h1;
  
                  r2_p1_LessThanK1 = Math.abs(r2_p1) < k1
                  r2_p1_LessThanK2 = Math.abs(r2_p1) < k2
                  r2_p1_LessThanH3 = Math.abs(r2_p1) < h3;
                  r2_p1_LessThanH2 = Math.abs(r2_p1) < h2;
                  r2_p1_LessThanH1 = Math.abs(r2_p1) < h1;
  
                  r2_p2_LessThanK1 = Math.abs(r2_p2) < k1
                  r2_p2_LessThanK2 = Math.abs(r2_p2) < k2
                  r2_p2_LessThanH3 = Math.abs(r2_p2) < h3;
                  r2_p2_LessThanH2 = Math.abs(r2_p2) < h2;
                  r2_p2_LessThanH1 = Math.abs(r2_p2) < h1;
  
                  r2_p3_LessThanK1 = Math.abs(r2_p3) < k1
                  r2_p3_LessThanK2 = Math.abs(r2_p3) < k2
                  r2_p3_LessThanH3 = Math.abs(r2_p3) < h3;
                  r2_p3_LessThanH2 = Math.abs(r2_p3) < h2;
                  r2_p3_LessThanH1 = Math.abs(r2_p3) < h1;

  
                  if(r2_m3_LessThanH1) { r2_m3_qi = 0;}
                  else if(r2_m3_LessThanH2) {
                      r2_m3/D >= 0 ? r2_m3_qi = 1: r2_m3_qi = -1;
                  }
                  else if (r2_m3_LessThanH3) {
                      r2_m3/D >= 0 ? r2_m3_qi = 2: r2_m3_qi = -2;
                  }
                  else {
                      r2_m3/D >= 0 ? r2_m3_qi = 3: r2_m3_qi = -3;
                  }


                  if(r2_m2_LessThanH1) { r2_m2_qi = 0;}
		  else if(r2_m2_LessThanH2) {
                      r2_m2/D >= 0 ? r2_m2_qi = 1: r2_m2_qi = -1;
                  }
                  else if (r2_m2_LessThanH3) {
                      r2_m2/D >= 0 ? r2_m2_qi = 2: r2_m2_qi = -2;
                  }
                  else {
                      r2_m2/D >= 0 ? r2_m2_qi = 3: r2_m2_qi = -3;
                  }



                  if(r2_m1_LessThanH1) { r2_m1_qi = 0;}
                  else if(r2_m1_LessThanH2) {
                      r2_m1/D >= 0 ? r2_m1_qi = 1: r2_m1_qi = -1;
                  }
                  else if (r2_m1_LessThanH3) {
                      r2_m1/D >= 0 ? r2_m1_qi = 2: r2_m1_qi = -2;
                  }
                  else {
                      r2_m1/D >= 0 ? r2_m1_qi = 3: r2_m1_qi = -3;
                  }


                  if(r2_LessThanH1) { r2_qi = 0;}
                  else if(r2_LessThanH2) {
                      r2/D >= 0 ? r2_qi = 1: r2_qi = -1;
                  }
                  else if (r2_LessThanH3) {
                      r2/D >= 0 ? r2_qi = 2: r2_qi = -2;
                  }
                  else {
                      r2/D >= 0 ? r2_qi = 3: r2_qi = -3;
                  }


                  if(r2_p1_LessThanH1) { r2_p1_qi = 0;}
                  else if(r2_p1_LessThanH2) {
                      r2_p1/D >= 0 ? r2_p1_qi = 1: r2_p1_qi = -1;
                  }
                  else if (r2_p1_LessThanH3) {
                      r2_p1/D >= 0 ? r2_p1_qi = 2: r2_p1_qi = -2;
                  }
                  else {
                      r2_p1/D >= 0 ? r2_p1_qi = 3: r2_p1_qi = -3;
                  }


                  if(r2_p2_LessThanH1) { r2_p2_qi = 0;}
                  else if(r2_p2_LessThanH2) {
                      r2_p2/D >= 0 ? r2_p2_qi = 1: r2_p2_qi = -1;
                  }
                  else if (r2_p2_LessThanH3) {
                      r2_p2/D >= 0 ? r2_p2_qi = 2: r2_p2_qi = -2;
                  }
                  else {
                      r2_p2/D >= 0 ? r2_p2_qi = 3: r2_p2_qi = -3;
                  }


                  if(r2_p3_LessThanH1) { r2_p3_qi = 0;}
                  else if(r2_p3_LessThanH2) {
                      r2_p3/D >= 0 ? r2_p3_qi = 1: r2_p3_qi = -1;
                  }
                  else if (r2_p3_LessThanH3) {
                      r2_p3/D >= 0 ? r2_p3_qi = 2: r2_p3_qi = -2;
                  }
                  else {
                      r2_p3/D >= 0 ? r2_p3_qi = 3: r2_p3_qi = -3;
                  }


                SumSize =    Math.max (OrderOfMagnitude(4 *  r),
                                       OrderOfMagnitude(16 * r - 12* D),
                                       OrderOfMagnitude(16 * r - 8 * D),
                                       OrderOfMagnitude(16 * r - 4 * D),
                                       OrderOfMagnitude(16 * r - 0 * D),
                                       OrderOfMagnitude(16 * r - 4 * D),
                                       OrderOfMagnitude(16 * r - 8 * D),
                                       OrderOfMagnitude(16 * r - 12* D),
                                       OrderOfMagnitude(16 * r + 12* D),
                                       OrderOfMagnitude(16 * r + 8 * D),
                                       OrderOfMagnitude(16 * r + 4 * D),
                                       OrderOfMagnitude(16 * r + 0 * D),
                                       OrderOfMagnitude(16 * r + 4 * D),
                                       OrderOfMagnitude(16 * r + 8 * D),
                                       OrderOfMagnitude(16 * r + 12* D))
                                    
                // ----------------------------------------------------------------
                // Stage 1
                Middle += "<TR> <TD> <font color=red>Stage1: 4r<SUB>" + i + "</SUB>"
                Middle += "<TD><font color=red>"
                Middle += PrintTwosComp(4 * r, SumSize,1);
                Middle += "<font color=red> &nbsp  &nbsp  "

                if(r1_LessThanH1) {
                   Middle += (r1 >= 0 ? "r < " + sh1 : "r > " + "-" + sh1);
                }
                else if(r1_LessThanH2) {
                   Middle += (r1 >= 0 ? sh1 +" <= r < "+sh2 : "-"+sh2 +" < r <= " + "-" + sh1);
                }
                else if(r1_LessThanH3) {
                   Middle += (r1 >= 0 ? sh2 +" <= r < "+sh3 : "-"+sh3 +" < r <= -"+sh2);
                }
                else {
                   Middle += (r1 > 0 ? "r >= "+sh3 : "r < "+ "-"+sh3);
                }

                // Middle += " (r = " + r + ") "
                // if (r1_LessThanHalf) Middle += " (r1_LessThanHalf) "
                // if (EqualsHalf) Middle += " (EqualsHalf) "
                Middle += "    set q<SUB>" + (i + 1) + "</SUB> = ";
                Q += Math.pow(4, -i - 1) * r1_qi;
                Middle += r1_qi + " &nbsp , ADD " + (0 - r1_qi) + "D\n";

                // ----------------------------------------------------------------
                // Stage 2

                  if (r1_qi == -3) qi_plus1 = r2_p3_qi;
                  if (r1_qi == -2) qi_plus1 = r2_p2_qi;
                  if (r1_qi == -1) qi_plus1 = r2_p1_qi;
                  if (r1_qi ==  0) qi_plus1 = r2_qi   ;
                  if (r1_qi ==  1) qi_plus1 = r2_m1_qi;
                  if (r1_qi ==  2) qi_plus1 = r2_m2_qi;
                  if (r1_qi ==  3) qi_plus1 = r2_m3_qi;

                  Middle += "<TR> <TD><font color=red>Stage2: 4*(4r<SUB>" 
                  if (r1_qi == +3) {Middle += i + "</SUB> - 3D) <TD> " + PrintTwosComp(r2_m3, SumSize,1) + " &nbsp &nbsp ";
                                    radix4(1,r2_m3_LessThanH1,r2_m3_LessThanH2,r2_m3_LessThanH3,r2_m3, r2_m3_qi);}
                  if (r1_qi == +2) {Middle += i + "</SUB> - 2D) <TD> " + PrintTwosComp(r2_m2, SumSize,1) + " &nbsp &nbsp "
                                    radix4(1,r2_m2_LessThanH1,r2_m2_LessThanH2,r2_m2_LessThanH3,r2_m2, r2_m2_qi);}
                  if (r1_qi == +1) {Middle += i + "</SUB> - 1D) <TD> " + PrintTwosComp(r2_m1, SumSize,1) + " &nbsp &nbsp "
                                    radix4(1,r2_m1_LessThanH1,r2_m1_LessThanH2,r2_m1_LessThanH3,r2_m1, r2_m1_qi);}
                  if (r1_qi == +0) {Middle += i + "</SUB> + 0D) <TD> " + PrintTwosComp(r2   , SumSize,1) + " &nbsp &nbsp "
                                    radix4(1,r2_LessThanH1,r2_LessThanH2,r2_LessThanH3,r2, r2_qi);}
                  if (r1_qi == -1) {Middle += i + "</SUB> + 1D) <TD> " + PrintTwosComp(r2_p1, SumSize,1) + " &nbsp &nbsp "
                                    radix4(1,r2_p1_LessThanH1,r2_p1_LessThanH2,r2_p1_LessThanH3,r2_p1, r2_p1_qi);}
                  if (r1_qi == -2) {Middle += i + "</SUB> + 2D) <TD> " + PrintTwosComp(r2_p2, SumSize,1) + " &nbsp &nbsp "
                                    radix4(1,r2_p2_LessThanH1,r2_p2_LessThanH2,r2_p2_LessThanH3,r2_p2, r2_p2_qi);}
                  if (r1_qi == -3) {Middle += i + "</SUB> + 3D) <TD> " + PrintTwosComp(r2_p3, SumSize,1) + " &nbsp &nbsp "
                                    radix4(1,r2_p3_LessThanH1,r2_p3_LessThanH2,r2_p3_LessThanH3,r2_p3, r2_p3_qi);}

                  if (r1_qi != +3) {Middle +="<TR> <TD>Stage2: 4*(4r<SUB>" + i + "</SUB> - 3D) <TD> " + PrintTwosComp(r2_m3, SumSize) + " &nbsp &nbsp "
                                    radix4(0,r2_m3_LessThanH1,r2_m3_LessThanH2,r2_m3_LessThanH3,r2_m3, r2_m3_qi);}
                  if (r1_qi != +2) {Middle +="<TR> <TD>Stage2: 4*(4r<SUB>" + i + "</SUB> -  2D) <TD> " + PrintTwosComp(r2_m2, SumSize) + " &nbsp &nbsp "
                                    radix4(0,r2_m2_LessThanH1,r2_m2_LessThanH2,r2_m2_LessThanH3,r2_m2, r2_m2_qi);}
                  if (r1_qi != +1) {Middle +="<TR> <TD>Stage2: 4*(4r<SUB>" + i + "</SUB> -  1D) <TD> " + PrintTwosComp(r2_m1, SumSize) + " &nbsp &nbsp "
                                    radix4(0,r2_m1_LessThanH1,r2_m1_LessThanH2,r2_m1_LessThanH3,r2_m1, r2_m1_qi);}
                  if (r1_qi != +0) {Middle +="<TR> <TD>Stage2: 4*(4r<SUB>" + i + "</SUB> +  0D) <TD> " + PrintTwosComp(r2   , SumSize) + " &nbsp &nbsp "
                                    radix4(0,r2_LessThanH1,r2_LessThanH2,r2_LessThanH3,r2, r2_qi);}
                  if (r1_qi != -1) {Middle +="<TR> <TD>Stage2: 4*(4r<SUB>" + i + "</SUB> +  1D) <TD> " + PrintTwosComp(r2_p1, SumSize) + " &nbsp &nbsp "
                                    radix4(0,r2_p1_LessThanH1,r2_p1_LessThanH2,r2_p1_LessThanH3,r2_p1, r2_p1_qi);}
                  if (r1_qi != -2) {Middle +="<TR> <TD>Stage2: 4*(4r<SUB>" + i + "</SUB> +  2D) <TD> " + PrintTwosComp(r2_p2, SumSize) + " &nbsp &nbsp "
                                    radix4(0,r2_p2_LessThanH1,r2_p2_LessThanH2,r2_p2_LessThanH3,r2_p2, r2_p2_qi);}
                  if (r1_qi != -3) {Middle +="<TR> <TD>Stage2: 4*(4r<SUB>" + i + "</SUB> +  3D) <TD> " + PrintTwosComp(r2_p3, SumSize) + " &nbsp &nbsp "
                                    radix4(0,r2_p3_LessThanH1,r2_p3_LessThanH2,r2_p3_LessThanH3,r2_p3, r2_p3_qi);}

                  r = RoundOff(4 * r - r1_qi * D)
                  Middle += "<TR> <TD> r<SUB>" + (i + 1) + "</SUB> ";
                  Middle += "=4r<SUB>" + i + "</SUB>-" + r1_qi + "D";
                  Middle += "<TD> " + PrintTwosComp(r, SumSize);

                  r = RoundOff(4 * r - qi_plus1 * D)
                  Middle += "<TR> <TD> r<SUB>" + (i + 2) + "</SUB> "
                  Middle += "=(16r<SUB>" + i + "</SUB>-" + (r1_qi*4+qi_plus1) + "D)";
                  Middle += "<TD> " + PrintTwosComp(r, SumSize);

                  Q += Math.pow(4, -i - 2) * qi_plus1;
                  Middle += "</table>"

                  Middle += "<table>"
        }

        Middle += "</TABLE> <P>\n";
        Middle += "Q = " + TwosComp(Q, 0) + " = " + Q + "<BR>\n"
        if (r/D < 0) { // if sign is different
                ulp = Math.pow(4, -NumDec_4)
                Middle += "R<i><sub>corrected</sub></i> = r<sub>" + i + "</sub>"
                if (Q/D > 0 || ZeroRem) {
                        Middle += " + D = " + TwosComp(r, 0) + " + " +
                        TwosComp(D, 0) + " = " + TwosComp(r + D, 0) + " = " +
                        (r + D) + "<BR>\n"
                        Middle += "Q<i><sub>corrected</sub></i> = Q - <i>ulp</i> = " +
                        TwosComp(Q, 0) + " - " + TwosComp(ulp, 0) + " = " +
                        TwosComp(Q - ulp, 0) + " = " + (Q - ulp)
                } else {
                        Middle += " - D = " + TwosComp(r, 3) + " - " +
                        TwosComp(D, 0) + " = " + TwosComp(r - D, 0) + " = " +
                        (r - D) + "<BR>\n"
                        Middle += "Q<i><sub>corrected</sub></i> = Q + <i>ulp</i> = " +
                        TwosComp(Q, 0) + " + " + TwosComp(ulp, 3) + " = " +
                        TwosComp(Q + ulp, 0) + " = " + (Q + ulp)
                }

        }

        d1 = qsel4_dly + mux3_dly + csa_dly + csa_dly
        d2 = qsel4_dly + mux7_dly + mux7_dly + csa_dly;
        d3 = csa_dly + qsel4_dly + mux7_dly + mux7_dly + csa_dly;
        Middle += "<br>Total iterations needed is " + (i/4);

        if ((d1 >= d2) && (d1>=d3))
        {
             Middle += "<br>\nDelay through circuit is " + d1 ;
             Middle += "<br>Critical path is through qsel, mux3, csa, csa";
             Middle += "<br>Total delay until final quotient is generated: " + (d1* (i/4));
        }
        else if ((d2 >= d1) && (d2>=d3))
        {
             Middle += "<br>Delay through circuit is " + d2 ;
             Middle += "<br>critical path is through qsel, mux7, mux7, csa";
             Middle += "<br>Total delay until final quotient is generated: " + d2* (i/4);
        }
        else
        {
             Middle += "<br>Delay through circuit is " + d3 ;
             Middle += "<br>critical path is through csa, qsel, mux7, mux7, csa";
             Middle += "<br>Total delay until final quotient is generated: " + d3* (i/4);
        }

        Bottom = "</BODY> </HTML>";
}

else if (Chose_srt2_4)
{
    Q=0;
    Middle += "<TR> <TD> r<SUB>0</SUB> = X <TD>";
    Middle += PrintTwosComp(r, OrderOfMagnitude(r) + 1);
    Middle += "<TD>\n"

    if(D < 0.625) {k1 = 0.25; sk1="0.010"}
    else {k1 = 0.375;sk1="0.011"}

    if(D < 0.5625) { k2 = 0.75;sk2="0.110"}
    else if(D < 0.625) { k2 = 0.875;sk2="0.111"}
    else if(D < 0.6875) {k2 = 1;sk2="1.000"}
    else if(D < 0.75) { k2 = 1.125;sk2="1.001"}
    else if(D < 0.875) { k2 = 1.25;sk2="1.010"}
    else if(D < 0.9375) {k2 = 1.375;sk2="1.011"}
    else {k2 = 1.5;sk2="1.100"}


    h1 = 0.5; sh1="0.1"
    h2 = 1.0; sh2="1.0"
    if(D < 0.75) { h3 = 1.5; sh3="1.1"}
    else {h3 = 2;sh3="10.0"}


    iteration = 1;
     
    for (i = 0; i < NumDecimals; i+=3) {
        Middle += MakeLine(NumCols + 3);
        Middle += "<TR><TD><B>Iteration " + iteration + "</B>";
        iteration++;

        // "qi" is a horrible misnomer because its actually
        // q(i + 1).


        //For 1st stage
        r1     = 2 * r;
        r1_lth = LessHalf(r1);
        r1_eqh = EqualHalf(r1);
        r1_qi  = getQi(r1);
        qi     = r1_qi;


        //Calculate all second  partial remainder
        // (2R+D)*4 = 8R+4D
        // (2R  )*4 = 8R
        // (2R-D)*4 = 8R-4D

        r2_p1 = 8*r + 4*D;
        r2    = 8*r      ;
        r2_m1 = 8*r - 4*D;

        r2_m1_LessThanK1 = Math.abs(r2_m1) < k1
        r2_m1_LessThanK2 = Math.abs(r2_m1) < k2
        r2_m1_LessThanH3 = Math.abs(r2_m1) < h3;
        r2_m1_LessThanH2 = Math.abs(r2_m1) < h2;
        r2_m1_LessThanH1 = Math.abs(r2_m1) < h1;

        r2_LessThanK1 = Math.abs(r2) < k1
        r2_LessThanK2 = Math.abs(r2) < k2
        r2_LessThanH3 = Math.abs(r2) < h3;
        r2_LessThanH2 = Math.abs(r2) < h2;
        r2_LessThanH1 = Math.abs(r2) < h1;

        r2_p1_LessThanK1 = Math.abs(r2_p1) < k1
        r2_p1_LessThanK2 = Math.abs(r2_p1) < k2
        r2_p1_LessThanH3 = Math.abs(r2_p1) < h3;
        r2_p1_LessThanH2 = Math.abs(r2_p1) < h2;
        r2_p1_LessThanH1 = Math.abs(r2_p1) < h1;
  
        if(r2_m1_LessThanH1) { r2_m1_qi = 0;}
        else if(r2_m1_LessThanH2) {
            r2_m1/D >= 0 ? r2_m1_qi = 1: r2_m1_qi = -1;
        }
        else if (r2_m1_LessThanH3) {
            r2_m1/D >= 0 ? r2_m1_qi = 2: r2_m1_qi = -2;
        }
        else {
            r2_m1/D >= 0 ? r2_m1_qi = 3: r2_m1_qi = -3;
        }


        if(r2_LessThanH1) { r2_qi = 0;}
        else if(r2_LessThanH2) {
            r2/D >= 0 ? r2_qi = 1: r2_qi = -1;
        }
        else if (r2_LessThanH3) {
            r2/D >= 0 ? r2_qi = 2: r2_qi = -2;
        }
        else {
            r2/D >= 0 ? r2_qi = 3: r2_qi = -3;
        }


        if(r2_p1_LessThanH1) { r2_p1_qi = 0;}
        else if(r2_p1_LessThanH2) {
            r2_p1/D >= 0 ? r2_p1_qi = 1: r2_p1_qi = -1;
        }
        else if (r2_p1_LessThanH3) {
            r2_p1/D >= 0 ? r2_p1_qi = 2: r2_p1_qi = -2;
        }
        else {
            r2_p1/D >= 0 ? r2_p1_qi = 3: r2_p1_qi = -3;
        }

        SumSize = Math.max (OrderOfMagnitude(2 * r),
                            OrderOfMagnitude(D * r1_qi * -1),
                            OrderOfMagnitude(8 * r - 4* D),
                            OrderOfMagnitude(8 * r       ),
                            OrderOfMagnitude(8 * r + 4*D))

        //----------------------------------------------------------
        //Stage1
           bit= i*(2/3);

           radix2(1, r1, r1_lth,r1_eqh,r1_qi,1, "2r" , ")");

        //-----------------------------------------------------------  

        //-----------------------------------------------------------
        //Stage2
        //

           if (r1_qi == -1) qi_plus1 = r2_p1_qi;
           if (r1_qi ==  0) qi_plus1 = r2_qi   ;
           if (r1_qi ==  1) qi_plus1 = r2_m1_qi;

           Middle += "<TR> <TD><font color=red>Stage2: 4*(2r<SUB>" 
           if (r1_qi == +1) {Middle += bit + "</SUB> - 1D) <TD> " + PrintTwosComp(r2_m1, SumSize,1) + " &nbsp &nbsp "
                             radix4(1,r2_m1_LessThanH1,r2_m1_LessThanH2,r2_m1_LessThanH3,r2_m1, r2_m1_qi);}
           if (r1_qi == +0) {Middle += bit + "</SUB> + 0D) <TD> " + PrintTwosComp(r2   , SumSize,1) + " &nbsp &nbsp "
                             radix4(1,r2_LessThanH1,r2_LessThanH2,r2_LessThanH3,r2, r2_qi);}
           if (r1_qi == -1) {Middle += bit + "</SUB> + 1D) <TD> " + PrintTwosComp(r2_p1, SumSize,1) + " &nbsp &nbsp "
                             radix4(1,r2_p1_LessThanH1,r2_p1_LessThanH2,r2_p1_LessThanH3,r2_p1, r2_p1_qi);}

           if (r1_qi != +1) {Middle +="<TR> <TD>Stage2: 4*(2r<SUB>" + bit + "</SUB> -  1D) <TD> " + PrintTwosComp(r2_m1, SumSize) + " &nbsp &nbsp "
                             radix4(0,r2_m1_LessThanH1,r2_m1_LessThanH2,r2_m1_LessThanH3,r2_m1, r2_m1_qi);}
           if (r1_qi != +0) {Middle +="<TR> <TD>Stage2: 4*(2r<SUB>" + bit + "</SUB> +  0D) <TD> " + PrintTwosComp(r2   , SumSize) + " &nbsp &nbsp "
                             radix4(0,r2_LessThanH1,r2_LessThanH2,r2_LessThanH3,r2, r2_qi);}
           if (r1_qi != -1) {Middle +="<TR> <TD>Stage2: 4*(2r<SUB>" + bit + "</SUB> +  1D) <TD> " + PrintTwosComp(r2_p1, SumSize) + " &nbsp &nbsp "
                             radix4(0,r2_p1_LessThanH1,r2_p1_LessThanH2,r2_p1_LessThanH3,r2_p1, r2_p1_qi);}

           r = RoundOff(2 * r - r1_qi * D)
           Middle += "<TR> <TD> r<SUB>" + (bit + 1) + "</SUB> ";
           Middle += "=2r<SUB>" + bit + "</SUB>-" + r1_qi + "D";
           Middle += "<TD> " + PrintTwosComp(r, SumSize);
           Q  += Math.pow(2, -i - 1) * r1_qi;

           r = RoundOff(4 * r - qi_plus1 * D)
           Middle += "<TR> <TD> r<SUB>" + (bit + 2) + "</SUB> "
           Middle += "=(8r<SUB>" + bit + "</SUB>-" + (r1_qi*4+qi_plus1) + "D)";
           Middle += "<TD> " + PrintTwosComp(r, SumSize);

           Q  += Math.pow(2, -i - 1)*.25 * qi_plus1;
           Middle += "</table>"
           Middle += "<table>"
    }


    Middle += "</TABLE> <P>\n";
    Middle += "Q = " + TwosComp(Q, 0) + " = " + Q + "<BR>\n"
    if (r/D < 0) { // if sign is different
        ulp = Math.pow(2, -NumDecimals)
        Middle += "R<i><sub>corrected</sub></i> = r<sub>" + i + "</sub>"
        if (Q/D > 0 || ZeroRem) {
            Middle += " + D = " + TwosComp(r, 0) + " + " +
            TwosComp(D, 0) + " = " + TwosComp(r + D, 0) + " = " +
            (r + D) + "<BR>\n"
            Middle += "Q<i><sub>corrected</sub></i> = Q - <i>ulp</i> = " +
            TwosComp(Q, 0) + " - " + TwosComp(ulp, 0) + " = " +
            TwosComp(Q - ulp, 0) + " = " + (Q - ulp)
        } else {
            Middle += " - D = " + TwosComp(r, 3) + " - " +
            TwosComp(D, 0) + " = " + TwosComp(r - D, 0) + " = " +
            (r - D) + "<BR>\n"
            Middle += "Q<i><sub>corrected</sub></i> = Q + <i>ulp</i> = " +
            TwosComp(Q, 0) + " + " + TwosComp(ulp, 3) + " = " +
            TwosComp(Q + ulp, 0) + " = " + (Q + ulp)
        }

    }

        d1 = qsel2_dly + mux3_dly + csa_dly + csa_dly
        d2 = csa_dly + qsel4_dly + mux3_dly + mux7_dly + csa_dly;
        Middle += "<br>Total iterations needed is " + (i/3);

        if (d1 > d2)
        {
             Middle += "<br>\nDelay through circuit is " + d1 ;
             Middle += "<br>Critical path is through qsel radix-2, mux3, csa, csa";
             Middle += "<br>Total delay until final quotient is generated: " + d1* (i/3);
        }
        else
        {
             Middle += "<br>Delay through circuit is " + d2 ;
             Middle += "<br>critical path is through csa, qsel radix-4, mux3, mux7, csa";
             Middle += "<br>Total delay until final quotient is generated: " + d2* (i/3);
        }

    Bottom = "</BODY> </HTML>";
}

else if (Chose_srt4_2)
{

        SumSize = Math.max (OrderOfMagnitude(4 *  r),
                            OrderOfMagnitude(16 * r - 12* D),
                            OrderOfMagnitude(16 * r - 8 * D),
                            OrderOfMagnitude(16 * r - 4 * D),
                            OrderOfMagnitude(16 * r - 0 * D),
                            OrderOfMagnitude(16 * r - 4 * D),
                            OrderOfMagnitude(16 * r - 8 * D),
                            OrderOfMagnitude(16 * r - 12* D),
                            OrderOfMagnitude(16 * r + 12* D),
                            OrderOfMagnitude(16 * r + 8 * D),
                            OrderOfMagnitude(16 * r + 4 * D),
                            OrderOfMagnitude(16 * r + 0 * D),
                            OrderOfMagnitude(16 * r + 4 * D),
                            OrderOfMagnitude(16 * r + 8 * D),
                            OrderOfMagnitude(16 * r + 12* D))

        Middle += "<TR> <TD> r<SUB>0</SUB> = X <TD>";
        Middle += PrintTwosComp(r, SumSize);
        Middle += "<TD>\n"
        NumDec_4 = Math.floor(NumDecimals/2);

        if(D < 0.625) {k1 = 0.25; sk1="0.010"}
        else {k1 = 0.375;sk1="0.011"}

        if(D < 0.5625) { k2 = 0.75;sk2="0.110"}
        else if(D < 0.625) { k2 = 0.875;sk2="0.111"}
        else if(D < 0.6875) {k2 = 1;sk2="1.000"}
        else if(D < 0.75) { k2 = 1.125;sk2="1.001"}
        else if(D < 0.875) { k2 = 1.25;sk2="1.010"}
        else if(D < 0.9375) {k2 = 1.375;sk2="1.011"}
        else {k2 = 1.5;sk2="1.100"}

        h1 = 0.5; sh1="0.1"
        h2 = 1.0; sh2="1.0"
        if(D < 0.75) { h3 = 1.5; sh3="1.1"}
        else {h3 = 2;sh3="10.0"}

        iteration = 1;

        for (i = 0; i < NumDecimals; i+=3) {
                Middle += MakeLine(NumCols + 5);
                Middle += "<TR><TD><B>Iteration " + iteration + "</B>";
                iteration++;

 
                // "qi" is a horrible misnomer because its actually
                // q(i + 1).
                r1 = 4 * r;

                //Calculate first partial remainder
                r1_LessThanK1 = Math.abs(r1) < k1
                r1_LessThanK2 = Math.abs(r1) < k2
                r1_LessThanH3 = Math.abs(r1) < h3;
                r1_LessThanH2 = Math.abs(r1) < h2;
                r1_LessThanH1 = Math.abs(r1) < h1;

              
                if(r1_LessThanH1) { r1_qi = 0;}
                else if(r1_LessThanH2) {
                    r/D >= 0 ? r1_qi = 1: r1_qi = -1;
                }
                else if (r1_LessThanH3) {
                    r/D >= 0 ? r1_qi = 2: r1_qi = -2;
                }
                else {
                    r/D >= 0 ? r1_qi = 3: r1_qi = -3;
                }

                //Calculate all second  partial remainder
                // (4R-3D)*2 = 8R- 6D
                // (4R-2D)*2 = 8R- 4D
                // (4R-1D)*2 = 8R- 2D
                // (4R   )*2 = 8R
                // (4R+1D)*2 = 8R+ 2D
                // (4R+2D)*2 = 8R+ 4D
                // (4R+3D)*2 = 8R+ 6D

                //For 2nd stage
                //(4r - 3D) * 2
                r2_m3      = (8 * r - 6 * D);
                r2_m3_lth  = LessHalf(r2_m3);
                r2_m3_eqh  = EqualHalf(r2_m3);
                r2_m3_qi   = getQi(r2_m3);
        
                //(4r - 2D) * 2
                r2_m2      = (8 * r - 4 * D);
                r2_m2_lth  = LessHalf(r2_m2);
                r2_m2_eqh  = EqualHalf(r2_m2);
                r2_m2_qi   = getQi(r2_m2);
        
                //(4r - 1D) * 2
                r2_m1      = (8 * r - 2 * D);
                r2_m1_lth  = LessHalf(r2_m1);
                r2_m1_eqh  = EqualHalf(r2_m1);
                r2_m1_qi   = getQi(r2_m1);
        
                //(4r ) * 2
                r2      = (8 * r);
                r2_lth  = LessHalf(r2);
                r2_eqh  = EqualHalf(r2);
                r2_qi   = getQi(r2);
        
                //(4r + 1d ) * 2
                r2_p1      = (8 * r + 2 * D);
                r2_p1_lth  = LessHalf(r2_p1);
                r2_p1_eqh  = EqualHalf(r2_p1);
                r2_p1_qi   = getQi(r2_p1);
        
                //(4r + 2d ) * 2
                r2_p2      = (8 * r + 4 * D);
                r2_p2_lth  = LessHalf(r2_p2);
                r2_p2_eqh  = EqualHalf(r2_p2);
                r2_p2_qi   = getQi(r2_p2);
        
                //(4r + 3d ) * 2
                r2_p3      = (8 * r + 6 * D);
                r2_p3_lth  = LessHalf(r2_p3);
                r2_p3_eqh  = EqualHalf(r2_p3);
                r2_p3_qi   = getQi(r2_p3);

                SumSize =    Math.max (OrderOfMagnitude(4 *  r),
                                       OrderOfMagnitude(8 * r - 6* D),
                                       OrderOfMagnitude(8 * r - 4 * D),
                                       OrderOfMagnitude(8 * r - 2 * D),
                                       OrderOfMagnitude(8 * r - 0 * D),
                                       OrderOfMagnitude(8 * r + 2 * D),
                                       OrderOfMagnitude(8 * r + 4 * D),
                                       OrderOfMagnitude(8 * r + 6 * D))
                                    
                // ----------------------------------------------------------------
                // Stage 1
                bit= i*(2/3);

                Middle += "<TR> <TD> <font color=red>Stage1: 4r<SUB>" + bit + "</SUB>"
                Middle += "<TD><font color=red>"
                Middle += PrintTwosComp(4 * r, SumSize,1);
                Middle += "<font color=red> &nbsp  &nbsp  "

                if(r1_LessThanH1) {
                   Middle += (r1 >= 0 ? "r < " + sh1 : "r > " + "-" + sh1);
                }
                else if(r1_LessThanH2) {
                   Middle += (r1 >= 0 ? sh1 +" <= r < "+sh2 : "-"+sh2 +" < r <= " + "-" + sh1);
                }
                else if(r1_LessThanH3) {
                   Middle += (r1 >= 0 ? sh2 +" <= r < "+sh3 : "-"+sh3 +" < r <= -"+sh2);
                }
                else {
                   Middle += (r1 > 0 ? "r >= "+sh3 : "r < "+ "-"+sh3);
                }

                // Middle += " (r = " + r + ") "
                // if (r1_LessThanHalf) Middle += " (r1_LessThanHalf) "
                // if (EqualsHalf) Middle += " (EqualsHalf) "
                Middle += "    set q<SUB>" + (bit + 1) + "</SUB> = ";
                Q += Math.pow(4, (-i/2) - 1) * r1_qi;
                Middle += r1_qi + " &nbsp , ADD " + (0 - r1_qi) + "D\n";

                // ----------------------------------------------------------------
                // Stage 2

                  if (r1_qi == -3) qi_plus1 = r2_p3_qi;
                  if (r1_qi == -2) qi_plus1 = r2_p2_qi;
                  if (r1_qi == -1) qi_plus1 = r2_p1_qi;
                  if (r1_qi ==  0) qi_plus1 = r2_qi   ;
                  if (r1_qi ==  1) qi_plus1 = r2_m1_qi;
                  if (r1_qi ==  2) qi_plus1 = r2_m2_qi;
                  if (r1_qi ==  3) qi_plus1 = r2_m3_qi;

                  if (r1_qi == +3) {radix2(1, r2_m3, r2_m3_lth, r2_m3_eqh, r2_m3_qi, 2, "2*(4r", "-3D))" );}
                  if (r1_qi == +2) {radix2(1, r2_m2, r2_m2_lth, r2_m2_eqh, r2_m2_qi, 2, "2*(4r", "-2D))" );}
                  if (r1_qi == +1) {radix2(1, r2_m1, r2_m1_lth, r2_m1_eqh, r2_m1_qi, 2, "2*(4r", "-1D))" );}
                  if (r1_qi == +0) {radix2(1, r2   , r2_lth   , r2_eqh   , r2_qi   , 2, "2*(4r", "))"    );}
                  if (r1_qi == -1) {radix2(1, r2_p1, r2_p1_lth, r2_p1_eqh, r2_p1_qi, 2, "2*(4r", "+1D))" );}
                  if (r1_qi == -2) {radix2(1, r2_p2, r2_p2_lth, r2_p2_eqh, r2_p2_qi, 2, "2*(4r", "+2D))" );}
                  if (r1_qi == -3) {radix2(1, r2_p3, r2_p3_lth, r2_p3_eqh, r2_p3_qi, 2, "2*(4r", "+3D))" );}

                  if (r1_qi != +3) {radix2(0, r2_m3, r2_m3_lth, r2_m3_eqh, r2_m3_qi, 2, "2*(4r", "-3D))" );}
                  if (r1_qi != +2) {radix2(0, r2_m2, r2_m2_lth, r2_m2_eqh, r2_m2_qi, 2, "2*(4r", "-2D))" );}
                  if (r1_qi != +1) {radix2(0, r2_m1, r2_m1_lth, r2_m1_eqh, r2_m1_qi, 2, "2*(4r", "-1D))" );}
                  if (r1_qi != +0) {radix2(0, r2   , r2_lth   , r2_eqh   , r2_qi   , 2, "2*(4r", "))"    );}
                  if (r1_qi != -1) {radix2(0, r2_p1, r2_p1_lth, r2_p1_eqh, r2_p1_qi, 2, "2*(4r", "+1D))" );}
                  if (r1_qi != -2) {radix2(0, r2_p2, r2_p2_lth, r2_p2_eqh, r2_p2_qi, 2, "2*(4r", "+2D))" );}
                  if (r1_qi != -3) {radix2(0, r2_p3, r2_p3_lth, r2_p3_eqh, r2_p3_qi, 2, "2*(4r", "+3D))" );}
                                    
                  r = RoundOff(4 * r - r1_qi * D)
                  Middle += "<TR> <TD> r<SUB>" + (bit + 1) + "</SUB> ";
                  Middle += "=4r<SUB>" + bit + "</SUB>-" + r1_qi + "D";
                  Middle += "<TD> " + PrintTwosComp(r, SumSize);

                  r = RoundOff(2 * r - qi_plus1 * D)
                  Middle += "<TR> <TD> r<SUB>" + (bit + 2) + "</SUB> "
                  Middle += "=(8r<SUB>" + bit + "</SUB>-" + (r1_qi*2+qi_plus1) + "D)";
                  Middle += "<TD> " + PrintTwosComp(r, SumSize);

                  Q += Math.pow(4, (-i/2) - 1)/2 * qi_plus1;
                  Middle += "</table>"


                  Middle += "<table>"
        }

        Middle += "</TABLE> <P>\n";
        Middle += "Q = " + TwosComp(Q, 0) + " = " + Q + "<BR>\n"
        if (r/D < 0) { // if sign is different
                ulp = Math.pow(4, -NumDec_4)
                Middle += "R<i><sub>corrected</sub></i> = r<sub>" + i + "</sub>"
                if (Q/D > 0 || ZeroRem) {
                        Middle += " + D = " + TwosComp(r, 0) + " + " +
                        TwosComp(D, 0) + " = " + TwosComp(r + D, 0) + " = " +
                        (r + D) + "<BR>\n"
                        Middle += "Q<i><sub>corrected</sub></i> = Q - <i>ulp</i> = " +
                        TwosComp(Q, 0) + " - " + TwosComp(ulp, 0) + " = " +
                        TwosComp(Q - ulp, 0) + " = " + (Q - ulp)
                } else {
                        Middle += " - D = " + TwosComp(r, 3) + " - " +
                        TwosComp(D, 0) + " = " + TwosComp(r - D, 0) + " = " +
                        (r - D) + "<BR>\n"
                        Middle += "Q<i><sub>corrected</sub></i> = Q + <i>ulp</i> = " +
                        TwosComp(Q, 0) + " + " + TwosComp(ulp, 3) + " = " +
                        TwosComp(Q + ulp, 0) + " = " + (Q + ulp)
                }

        }
        d1 = qsel4_dly + mux7_dly + csa_dly + csa_dly
        d2 = csa_dly + qsel2_dly + mux7_dly + mux3_dly + csa_dly;
        Middle += "<br>Total iterations needed is " + (i/3);

        if (d1 > d2)
        {
             Middle += "<br>\nDelay through circuit is " + d1 ;
             Middle += "<br>Critical path is through qsel radix-4, mux7, csa, csa";
             Middle += "<br>Total delay until final quotient is generated: " + d1* (i/3);
        }
        else
        {
             Middle += "<br>Delay through circuit is " + d2 ;
             Middle += "<br>critical path is through csa, qsel radix-2, mux7, mux3, csa";
             Middle += "<br>Total delay until final quotient is generated: " + d2* (i/3);
        }
        Bottom = "</BODY> </HTML>";
}

    if( (NumBits % 2) == 0) {Middle = PrintError("The number of bits should be odd.")}; 


    if (NumDecimals < 0) {Middle = PrintError("Overflow")}
    if (X > D) {Middle = PrintError("X cannot be larger than D")}
    if (D == 0) {Middle = PrintError("Divide by zero")}
    if (NotBinary) {Middle = PrintError("At least one non-binary number")}

    parent.frames[1].document.open()
    parent.frames[1].document.write(TheTop);
    parent.frames[1].document.write(Middle);
    parent.frames[1].document.write(Bottom);
    parent.frames[1].document.close()

}

</SCRIPT>
</HEAD>

<BODY bgcolor="#FFFF7C">

<CENTER> <H2> Division using overlapping SRT stages </H2> </CENTER>
<FORM>
X: <INPUT type="text" name="X" value=".25">
<P>
D: <INPUT type="text" name="D" value=".75">
<P>
<EM>bin</EM> <INPUT type="radio" name="Base" value="Binary" >
<EM>dec</EM> <INPUT type="radio" name="Base" value="Decimal" checked>
<P>
Number of bits (odd):<BR>
<INPUT type="text" name="NumBits" value="9">
<P>
Type of divider to use:
<P>
<table>
<TR><TD>srt-4 comprised of 2 srt-2<INPUT type="radio" name="srt_type" value="srt2_2" checked></TR>
<TR><TD>srt-8 comprised of 3 srt-2<INPUT type="radio" name="srt_type" value="srt2_2_2" ></TR>
<TR><TD>srt-8 comprised of srt-2 then a srt-4<INPUT type="radio" name="srt_type" value="srt2_4" ></TR>
<TR><TD>srt-8 comprised of srt-4 then a srt-2<INPUT type="radio" name="srt_type" value="srt4_2" ></TR>
<TR><TD>srt-16 comprised of 4 srt-2<INPUT type="radio" name="srt_type" value="srt4_2"></TR>
<TR><TD>srt-16 comprised of 2 srt-4<INPUT type="radio" name="srt_type" value="srt4_4"></TR>
</table>
<P>
<table BORDER>
<caption><b>Signal Delays</b></caption>
<tr>
<td>CSA</td>
<td><input type="text" name="csa_dly" value=2.5 size=4></td>
</tr>

<tr>
<td>3 input Mux</td>
<td><input type="text" name="mux3_dly" value=0.9 size=4></td>
</tr>

<tr>
<td>7 input Mux</td>
<td><input type="text" name="mux7_dly" value=1.0 size=4></td>
</tr>

<tr>
<td>15 input Mux</td>
<td><input type="text" name="mux15_dly" value=1.2 size=4></td>
</tr>

<tr>
<td>Radix-2 Qsel</td>
<td><input type="text" name="q2sel_dly" value=1.5 size=4></td>
</tr>

<tr>
<td>Radix-4 Qsel</td>
<td><input type="text" name="q4sel_dly" value=2.0 size=4></td>
</tr>

</table>



<CENTER>
<INPUT type="button" name="enter" value="Compute"
onClick="SRT(this.form)">
</CENTER>
</FORM>

<p>
<center>
<input TYPE="button"  value="Help" onClick=parent.frames[1].location.href="help.html">
</center>
</p>


</BODY>
</HTML>
