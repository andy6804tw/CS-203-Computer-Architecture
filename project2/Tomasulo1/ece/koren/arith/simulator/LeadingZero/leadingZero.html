<HTML>
<HEAD>
<SCRIPT  language="JavaScript" src="arith_utils.js"></SCRIPT>
<SCRIPT  language="JavaScript" src="leading0.js"></SCRIPT>
<SCRIPT  language="JavaScript" src="FPAdd.js"></SCRIPT>

<TITLE>Leading Zero Detector</TITLE>
<BODY bgColor="#9C7BBD">



<SCRIPT  language="JavaScript">

returnVal=new Object();
returnVal.ActualNumLeadingZeros = 0;
returnVal.PredictNumLeadingZeros = 0;

function ComputeClicked(form)
{
    parent.frames[1].document.open();


    PredictLeading0(form.A.value,form.B.value,form.IEEEForm[0].checked,form.IEEEForm[1].checked,form.TypeNumber[0].checked,form.TypeNumber[1].checked,1,1,1,1,form.ShowAdd.checked);
    PredictLeading0(form.A.value,form.B.value,form.IEEEForm[0].checked,form.IEEEForm[1].checked,form.TypeNumber[0].checked,form.TypeNumber[1].checked,1,1,1,2,form.ShowAdd.checked);




    parent.frames[1].document.close();
}

function OpenWindow()
{
    parent.frames[1].document.open();
}

function CloseWindow()
{
    parent.frames[1].document.close();
}

function PredictLeading0(AVal,BVal,ChoseSing,ChoseDoub,ChoseHex,ChoseDec,verboseOut, SomeOut, exactByCallingAdd,algo, addVerboseOut){

    returnVal.ActualNumLeadingZeros = -1;
    returnVal.PredictNumLeadingZeros = -1;

    Continue = 1;

    if (ChoseDec) {
        if (! IsValidDecimal(AVal)) {
            Continue = 0
            Message = "A contains non-decimal characters "
            parent.frames[1].document.writeln(PrintError(Message))
        }
        if (! IsValidDecimal(BVal)) {
            Continue = 0
            Message = "B contains non-decimal characters "
            parent.frames[1].document.writeln(PrintError(Message))
        }
        if (Continue) {
            if (navigator.appVersion[0] > 3 ){
                with (Math) {
                    A = parseFloat(eval(AVal));
                    B = parseFloat(eval(BVal));
                }
            } else {
                A = parseFloat(eval(AVal));
                B = parseFloat(eval(BVal));
            }

            if (isNaN(A)) {
                Continue = 0;
                Message = " A is an invalid Number "
                parent.frames[1].document.writeln(PrintError(Message))
            }

            if (isNaN(B)) {
                Continue = 0;
                Message = " B is an invalid Number "
                parent.frames[1].document.writeln(PrintError(Message))
            }
        }
    }

    if (ChoseSing) {
        bits  = 23;
        bias  = 127;
        Total = 32;
    } else {
        bits  = 52;
        bias  = 1023;
        Total = 64;
    }

    Subtract = 0;

    if (ChoseHex) {

        A = AVal;
        B = BVal;
        l = A.length;
        if (l != (Total/4)) {
            Continue = 0;
            Message = " Total number of Characters in A Should be Equal to " + (Total/4)
            parent.frames[1].document.writeln(PrintError(Message))
        }

        l = B.length;
        if (l != (Total/4)) {
            Continue = 0;
            Message = " Total number of Characters in B Should be Equal to " + (Total/4)
            parent.frames[1].document.writeln(PrintError(Message))
        }

        // check for valid hexadecimal numbers
        if (! IsValidHex(A)) {
            Continue = 0
            Message = "A contains non-hexadecimal characters "
            parent.frames[1].document.writeln(PrintError(Message))
        }
        if (! IsValidHex(B)) {
            Continue = 0
            Message = "B contains non-hexadecimal characters "
            parent.frames[1].document.writeln(PrintError(Message))
        }

        if (Continue) {
            StrA = "";
            for (var i=0; i <(Total/4); i++) {
                temp = unsignedToBinStr(eval("0x" +A.charAt(i)), 4);
                StrA = StrA + temp;
            }

            StrB = "";
            for (var i=0; i <(Total/4); i++) {
                temp = unsignedToBinStr(eval("0x" +B.charAt(i)), 4);
                StrB = StrB + temp;
            }


            sa = StrA.charAt(0);
            sb = StrB.charAt(0);
            ea = BinToDec (StrA.slice(1,Total-bits))
            eb = BinToDec (StrB.slice(1,Total-bits))
            siga = BinToDec (StrA.slice(Total-bits, Total))
            sigb = BinToDec (StrB.slice(Total-bits, Total))


            if (ea == 0){
                A = Math.pow(-1,sa) * siga/Math.pow(2,bits) * Math.pow(2,1-bias) //*RAG s/ea/1/ *//
            } else{
                A = Math.pow(-1,sa) * (1+siga/Math.pow(2,bits)) * Math.pow(2,ea-bias)
            }
            if (eb == 0){
                B = Math.pow(-1,sb) * sigb/Math.pow(2,bits) * Math.pow(2,1-bias) //*RAG s/eb/1/ *//
            } else{
                B = Math.pow(-1,sb) * (1+sigb/Math.pow(2,bits)) * Math.pow(2,eb-bias)
            }
        }
    } /* end if (ChoseHex) */

    Alpha = new Structure();
    Beta  = new Structure();
    Gamma = new Structure();
    Correct = new Structure();
    returnStruct = new Structure();
    Alpha2 = new Structure();
    Beta2  = new Structure();

    {
/////////////////////////////////////////////////////////////////////////
        if (Continue) {

            Alpha = IEEERepresentation(Alpha, A, bits, bias);
            Beta  = IEEERepresentation(Beta, B, bits, bias);
            Alpha2 = IEEERepresentation(Alpha2, A, bits, bias);
            Beta2  = IEEERepresentation(Beta2, B, bits, bias);

            //  parent.frames[1].document.writeln("(Correct: "+Beta.f+"..)");
            //PrintStructure(Alpha)
            //PrintStructure(Beta)
            // Before Add/Sub Check for overflow, underflow, zero, Inf, NaN
            if (Alpha.OveF){
                Message = " An Overflow Occured in A"   ;
                Continue = 0;
                parent.frames[1].document.writeln(PrintError(Message));
            }
            if (Alpha.UndF) {
                Message =  " An Underflow Occured in A";
                Continue = 0;
                parent.frames[1].document.writeln(PrintError(Message));
            }
            if (Beta.OveF){
                Message =  " An Overflow Occured in B";
                Continue = 0;
                parent.frames[1].document.writeln(PrintError(Message));
            }
            if (Beta.UndF) {
                Message = " An Underflow Occured in B"
                Continue = 0;
                parent.frames[1].document.writeln(PrintError(Message))
            }


            OpS = (Subtract) ? "A-B  " : "A+B  ";

            if (Alpha.NanF && Beta.NanF){
                Continue = 0;
                parent.frames[1].document.writeln("<PRE>")
                PrintIEEENum("A    ","NaN" , Alpha.Sign, Alpha.f+1, Alpha.e, bits)
                PrintIEEENum("B    ","NaN", Beta.Sign, Beta.f+1, Beta.e, bits)
                PrintHR();
                parent.frames[1].document.writeln(OpS + " Result = NaN ")
            }

            if (Alpha.NanF && Continue){
                Continue = 0;
                parent.frames[1].document.writeln("<PRE>")
                PrintIEEENum("A    "," NaN" , Alpha.Sign, Alpha.f+1, Alpha.e, bits)
                PrintResult(Beta, "B    ");
                PrintHR();
                parent.frames[1].document.writeln(OpS + " Result = NaN ")
            }

            if (Beta.NanF && Continue) {
                Continue = 0;
                parent.frames[1].document.writeln("<PRE>")
                PrintResult(Alpha, "A    ");
                PrintIEEENum("B    "," NaN", Beta.Sign, Beta.f, Beta.e, bits)
                PrintHR();
                parent.frames[1].document.writeln(OpS + " Result = NaN ")
            }



            if (Alpha.InfF && Beta.InfF){
                Continue = 0;
                parent.frames[1].document.writeln("<PRE>")
                Sig = "+";
                if (Alpha.Sign) { Sig = "-";}
                PrintIEEENum("A    ",Sig +"Inf" , Alpha.Sign, Alpha.f +1, Alpha.e, bits)
                Sig = "+";
                if (Beta.Sign) { Sig = "-";}
                PrintIEEENum("B    ",Sig +"Inf", Beta.Sign, Beta.f + 1, Beta.e, bits)
                PrintHR();

                if (Alpha.Sign^Beta.Sign^Subtract){
                    //Invalid Operation
                    parent.frames[1].document.writeln(OpS + "  Invalid Operation   Result = NaN")
                }else{
                    //Valid Operation
                    if (Subtract){
                        if ((A-B)>=0){
                            Sig = "+";
                            temp = 0;
                        }else{
                            Sig = "-";
                            temp = 1;
                        }
                    }else{
                        if ((A+B)>=0){
                            Sig = "+";
                            temp = 0;
                        }else{
                            Sig = "-";
                            temp = 1;
                        }
                    }
                    PrintIEEENum(OpS,Sig +"Inf", temp, Beta.f+1, Beta.e, bits)
                }
            }
        }
        if (Continue && (Alpha.InfF^Beta.InfF)){
            if (Alpha.InfF){
                Gamma = Alpha;
                Continue = 0;
                parent.frames[1].document.writeln("<PRE>")
                Sig = "+";
                if (Alpha.Sign) { Sig = "-";}
                PrintIEEENum("A    ",Sig +"Inf" , Alpha.Sign, Alpha.f+1, Alpha.e, bits)
                PrintResult( Beta,"B    ");
                PrintHR();
                PrintIEEENum(OpS,Sig +"Inf" , Alpha.Sign, Alpha.f+1, Alpha.e, bits)
            } else {
                Gamma = Beta;
                Continue = 0;
                parent.frames[1].document.writeln("<PRE>")
                Sig = "+";
                if (Beta.Sign) { Sig = "-";}
                PrintResult( Alpha,"A    ");
                PrintIEEENum("B    ",Sig +"Inf", Beta.Sign, Beta.f+1, Beta.e, bits)
                PrintHR();
                Sig = "+";
                if (Beta.Sign^Subtract) { Sig = "-";}
                PrintIEEENum(OpS,Sig +"Inf" , Beta.Sign, Beta.f+1, Beta.e, bits)
            }
        }

        if (Continue) {

            if(algo==2)
            {
                numZero = LeadingZeroNew(Alpha, Beta, Gamma, verboseOut) ;
            }
            else if(algo==1)
            {
                numZero = LeadingZero(Alpha, Beta, Gamma, verboseOut) ;
            }

            if(numZero != -1)
            {

                returnVal.PredictNumLeadingZeros = numZero;

                if(exactByCallingAdd)
                {
                    if(addVerboseOut)
                    {
                        parent.frames[1].document.writeln("<PRE>");
                        parent.frames[1].document.writeln("<CENTER><h4>ADDITION</h4></CENTER>");

                        parent.frames[1].document.writeln("</PRE>");

                        PrintHR();

                    }
                    returnStruct = Add(Alpha2, Beta2, Correct,returnStruct,addVerboseOut,addVerboseOut)  ;
                }
                if(exactByCallingAdd)
                {
                    returnVal.ActualNumLeadingZeros = Alpha2.e - returnStruct.e;

                    if(verboseOut)
                    {
                        if((Alpha2.e - returnStruct.e) != numZero)
                        {
                            parent.frames[1].document.writeln("<PRE>");
                            parent.frames[1].document.writeln("Prediction off by "+ ((Alpha.e - returnStruct.e)-numZero)+"!");

                            parent.frames[1].document.writeln("Actual no. of Leading 0s:" + (Alpha.e - returnStruct.e));
                            parent.frames[1].document.writeln("</PRE>");

                            PrintHR();
                        }
                        else
                        {

                            parent.frames[1].document.writeln("<PRE>");
                            parent.frames[1].document.writeln("Correct prediction!");
                            parent.frames[1].document.writeln("</PRE>");

                            PrintHR();
                        }
                   }
                }
            }
        }
    }


    return returnVal;
}

</SCRIPT>
</HEAD>

<CENTER>
    <H3>Leading Zero Detector</H3>
</CENTER>

<FORM>

    <I>A:</I> <INPUT name=A size=16 value="67964000"> <P>
    <I>B:</I> <INPUT name=B size=16 value="e7933000"> <P>
    <I>hex</I> <INPUT CHECKED name=TypeNumber type=radio value=Hex>
    <I>dec</I> <INPUT name=TypeNumber type=radio value=Dec> <P><P>
    <I>single</I> <INPUT CHECKED name=IEEEForm type=radio value=ChoseSing>
    <I>double</I> <INPUT  name=IEEEForm type=radio value=ChoseDoub> <P>

    <I>show addition</I> <INPUT name=ShowAdd type=checkbox value=ShowAdd>

    <CENTER>

        <INPUT onclick=ComputeClicked(this.form) type=button value="  Compute  "> <P>

        <INPUT type=button  VALUE="   Reset   " onClick=parent.frames[1].location.href="../tablet.html"> <P>

        <CENTER>
            <INPUT type=button VALUE="   Help   " onClick=parent.frames[1].location.href="leadingZeroHelp.html"><P>
        </CENTER>


    </CENTER>
</FORM>
<CENTER>
    <H3>Test Applet</H3>
</CENTER>

<applet code="TestApplet.class" width="500" height ="350">
<p>You should see test applet here. If not visible, you will have to allow applets to run in your browser</p>

</P></BODY></HTML>
